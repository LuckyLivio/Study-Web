"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[51],{57051:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ae});var a=t(9950),l=t(46865),r=t(82777),i=t(12414),n=t(52941),c=t(33720),d=t(39818),o=t(89379),x=t(57491),m=t(19530),p=t(16467),u=t(46536),h=t(59961),g=t(82715);const j=e=>g.A.get("/study/notes",{params:e}),y=e=>g.A.post("/study/notes",e,{headers:{"Content-Type":"multipart/form-data"}}),b=(e,s)=>g.A.put("/study/notes/".concat(e),s,{headers:{"Content-Type":"multipart/form-data"}}),f=e=>g.A.delete("/study/notes/".concat(e)),N=e=>g.A.get("/study/materials",{params:e}),v=e=>g.A.post("/study/materials",e,{headers:{"Content-Type":"multipart/form-data"}}),w=e=>g.A.get("/study/materials/".concat(e,"/download"),{responseType:"blob"}),A=e=>g.A.delete("/study/materials/".concat(e)),k=e=>g.A.get("/study/plans",{params:e}),C=e=>g.A.post("/study/plans",e),S=(e,s)=>g.A.put("/study/plans/".concat(e),s),D=(e,s)=>g.A.put("/study/plans/".concat(e,"/tasks"),s),T=e=>g.A.delete("/study/plans/".concat(e)),P=()=>g.A.get("/study/reminders/upcoming");var E=t(22135),M=t(50544),O=t(15536),R=t(72933),_=t(9449),F=t(44414);const z=e=>{let{isOpen:s,onClose:t,note:l}=e;const[i,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)([]),[x,m]=(0,a.useState)(!1),p=!!l,{register:h,handleSubmit:g,reset:j,watch:f,formState:{errors:N}}=(0,_.mN)({defaultValues:{title:"",content:"",subject:"",category:"\u5176\u4ed6",difficulty:"\u4e2d\u7b49",tags:"",isPublic:!1}}),v=f("content");(0,a.useEffect)(()=>{j(l?{title:l.title,content:l.content,subject:l.subject,category:l.category,difficulty:l.difficulty,tags:l.tags.join(", "),isPublic:l.isPublic}:{title:"",content:"",subject:"",category:"\u5176\u4ed6",difficulty:"\u4e2d\u7b49",tags:"",isPublic:!1})},[l,j]);return(0,F.jsx)(E.e,{appear:!0,show:s,as:a.Fragment,children:(0,F.jsxs)(M.lG,{as:"div",className:"relative z-50",onClose:t,children:[(0,F.jsx)(E.e.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,F.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,F.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,F.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,F.jsx)(E.e.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,F.jsxs)(M.lG.Panel,{className:"w-full max-w-4xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,F.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,F.jsx)(M.lG.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:p?"\u7f16\u8f91\u7b14\u8bb0":"\u65b0\u5efa\u7b14\u8bb0"}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsxs)("button",{onClick:()=>m(!x),className:"flex items-center space-x-1 px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:[(0,F.jsx)(u.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:x?"\u7f16\u8f91":"\u9884\u89c8"})]}),(0,F.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,F.jsx)(O.A,{className:"h-6 w-6"})})]})]}),(0,F.jsxs)("form",{onSubmit:g(async e=>{try{n(!0);const s=new FormData;s.append("title",e.title),s.append("content",e.content),s.append("subject",e.subject),s.append("category",e.category),s.append("difficulty",e.difficulty),s.append("tags",JSON.stringify(e.tags.split(",").map(e=>e.trim()).filter(e=>e))),s.append("isPublic",e.isPublic.toString()),c.forEach(e=>{s.append("attachments",e)}),p?await b(l._id,s):await y(s),t()}catch(s){console.error("\u4fdd\u5b58\u7b14\u8bb0\u5931\u8d25:",s),alert("\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{n(!1)}}),className:"space-y-6",children:[(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u6807\u9898 *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({},h("title",{required:"\u8bf7\u8f93\u5165\u6807\u9898"})),{},{className:"input-field",placeholder:"\u8f93\u5165\u7b14\u8bb0\u6807\u9898"})),N.title&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.title.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u79d1\u76ee *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({},h("subject",{required:"\u8bf7\u8f93\u5165\u79d1\u76ee"})),{},{className:"input-field",placeholder:"\u5982\uff1a\u6570\u5b66\u3001\u82f1\u8bed\u3001\u8ba1\u7b97\u673a"})),N.subject&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.subject.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5206\u7c7b"}),(0,F.jsxs)("select",(0,o.A)((0,o.A)({},h("category")),{},{className:"input-field",children:[(0,F.jsx)("option",{value:"\u8bfe\u5802\u7b14\u8bb0",children:"\u8bfe\u5802\u7b14\u8bb0"}),(0,F.jsx)("option",{value:"\u590d\u4e60\u603b\u7ed3",children:"\u590d\u4e60\u603b\u7ed3"}),(0,F.jsx)("option",{value:"\u77e5\u8bc6\u70b9\u6574\u7406",children:"\u77e5\u8bc6\u70b9\u6574\u7406"}),(0,F.jsx)("option",{value:"\u9519\u9898\u96c6",children:"\u9519\u9898\u96c6"}),(0,F.jsx)("option",{value:"\u5176\u4ed6",children:"\u5176\u4ed6"})]}))]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u96be\u5ea6"}),(0,F.jsxs)("select",(0,o.A)((0,o.A)({},h("difficulty")),{},{className:"input-field",children:[(0,F.jsx)("option",{value:"\u7b80\u5355",children:"\u7b80\u5355"}),(0,F.jsx)("option",{value:"\u4e2d\u7b49",children:"\u4e2d\u7b49"}),(0,F.jsx)("option",{value:"\u56f0\u96be",children:"\u56f0\u96be"})]}))]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u6807\u7b7e"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({},h("tags")),{},{className:"input-field",placeholder:"\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\uff0c\u5982\uff1a\u91cd\u70b9, \u8003\u8bd5, \u96be\u70b9"}))]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u5185\u5bb9 * ",x&&"(\u9884\u89c8\u6a21\u5f0f)"]}),x?(0,F.jsx)("div",{className:"min-h-[300px] p-4 border border-gray-300 rounded-lg bg-gray-50",dangerouslySetInnerHTML:{__html:(w=v||"",w.replace(/^### (.*$)/gim,'<h3 class="text-lg font-semibold mt-4 mb-2">$1</h3>').replace(/^## (.*$)/gim,'<h2 class="text-xl font-semibold mt-4 mb-2">$1</h2>').replace(/^# (.*$)/gim,'<h1 class="text-2xl font-bold mt-4 mb-2">$1</h1>').replace(/\*\*(.*?)\*\*/gim,'<strong class="font-semibold">$1</strong>').replace(/\*(.*?)\*/gim,'<em class="italic">$1</em>').replace(/`(.*?)`/gim,'<code class="bg-gray-100 px-1 py-0.5 rounded text-sm">$1</code>').replace(/\n/gim,"<br>"))}}):(0,F.jsx)("textarea",(0,o.A)((0,o.A)({},h("content",{required:"\u8bf7\u8f93\u5165\u5185\u5bb9"})),{},{rows:12,className:"input-field resize-none",placeholder:"\u652f\u6301Markdown\u683c\u5f0f\uff1a\\n# \u4e00\u7ea7\u6807\u9898\\n## \u4e8c\u7ea7\u6807\u9898\\n**\u7c97\u4f53** *\u659c\u4f53*\\n`\u4ee3\u7801`"})),N.content&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.content.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u9644\u4ef6"}),(0,F.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,F.jsxs)("label",{className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg cursor-pointer transition-colors",children:[(0,F.jsx)(R.A,{className:"h-5 w-5 text-gray-600"}),(0,F.jsx)("span",{className:"text-sm text-gray-700",children:"\u9009\u62e9\u6587\u4ef6"}),(0,F.jsx)("input",{type:"file",multiple:!0,accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md",onChange:e=>{e.target.files&&d(Array.from(e.target.files))},className:"hidden"})]}),c.length>0&&(0,F.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map((e,s)=>(0,F.jsxs)("span",{className:"inline-flex items-center px-2 py-1 bg-primary-100 text-primary-800 text-xs rounded-full",children:[(0,F.jsx)(r.A,{className:"h-3 w-3 mr-1"}),e.name]},s))})]})]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("input",(0,o.A)((0,o.A)({},h("isPublic")),{},{type:"checkbox",className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})),(0,F.jsx)("label",{className:"ml-2 block text-sm text-gray-700",children:"\u516c\u5f00\u7b14\u8bb0\uff08\u5176\u4ed6\u4eba\u53ef\u4ee5\u67e5\u770b\uff09"})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,F.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"\u53d6\u6d88"}),(0,F.jsx)("button",{type:"submit",disabled:i,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:i?"\u4fdd\u5b58\u4e2d...":p?"\u66f4\u65b0":"\u521b\u5efa"})]})]})]})})})})]})});var w},B=e=>{let{searchTerm:s}=e;const[t,l]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[d,g]=(0,a.useState)(null),[y,b]=(0,a.useState)(!1),[N,v]=(0,a.useState)(1),[w,A]=(0,a.useState)(1),[k,C]=(0,a.useState)({subject:"",category:""}),S=async()=>{try{c(!0);if(!localStorage.getItem("token"))return console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u83b7\u53d6\u5b66\u4e60\u7b14\u8bb0"),void l([]);const e=await j((0,o.A)({page:N,limit:10,search:s},k));l(e.data),e.pagination&&A(e.pagination.pages)}catch(a){var e,t;console.error("\u83b7\u53d6\u5b66\u4e60\u7b14\u8bb0\u5931\u8d25:",a),"NETWORK_ERROR"!==(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.error)&&401!==(null===a||void 0===a||null===(t=a.response)||void 0===t?void 0:t.status)||(console.log("\u8ba4\u8bc1\u5931\u8d25\uff0c\u7528\u6237\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u767b\u5f55"),l([]))}finally{c(!1)}};(0,a.useEffect)(()=>{S()},[N,s,k]);const D=()=>{g(null),b(!0)},T=e=>{g(e),b(!0)},P=e=>{switch(e){case"\u7b80\u5355":return"bg-green-100 text-green-800";case"\u4e2d\u7b49":return"bg-yellow-100 text-yellow-800";case"\u56f0\u96be":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return i?(0,F.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[(0,F.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,F.jsxs)("select",{value:k.subject,onChange:e=>C((0,o.A)((0,o.A)({},k),{},{subject:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u79d1\u76ee"}),(0,F.jsx)("option",{value:"\u6570\u5b66",children:"\u6570\u5b66"}),(0,F.jsx)("option",{value:"\u82f1\u8bed",children:"\u82f1\u8bed"}),(0,F.jsx)("option",{value:"\u8ba1\u7b97\u673a",children:"\u8ba1\u7b97\u673a"}),(0,F.jsx)("option",{value:"\u7269\u7406",children:"\u7269\u7406"}),(0,F.jsx)("option",{value:"\u5316\u5b66",children:"\u5316\u5b66"})]}),(0,F.jsxs)("select",{value:k.category,onChange:e=>C((0,o.A)((0,o.A)({},k),{},{category:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u5206\u7c7b"}),["\u8bfe\u5802\u7b14\u8bb0","\u590d\u4e60\u603b\u7ed3","\u77e5\u8bc6\u70b9\u6574\u7406","\u9519\u9898\u96c6","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]})]}),(0,F.jsxs)("button",{onClick:D,className:"btn-primary flex items-center space-x-2",children:[(0,F.jsx)(x.A,{className:"h-5 w-5"}),(0,F.jsx)("span",{children:"\u65b0\u5efa\u7b14\u8bb0"})]})]}),0===t.length?(0,F.jsxs)("div",{className:"text-center py-12",children:[(0,F.jsx)(r.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,F.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"\u6682\u65e0\u7b14\u8bb0"}),(0,F.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"\u5f00\u59cb\u521b\u5efa\u4f60\u7684\u7b2c\u4e00\u4e2a\u5b66\u4e60\u7b14\u8bb0\u5427\uff01"}),(0,F.jsx)("div",{className:"mt-6",children:(0,F.jsxs)("button",{onClick:D,className:"btn-primary",children:[(0,F.jsx)(x.A,{className:"h-5 w-5 mr-2"}),"\u65b0\u5efa\u7b14\u8bb0"]})})]}):(0,F.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{return(0,F.jsxs)("div",{className:"card hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:()=>T(e),children:[(0,F.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2",children:e.title}),(0,F.jsxs)("div",{className:"flex space-x-1 ml-2",children:[(0,F.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e)},className:"p-1 text-gray-400 hover:text-primary-600 transition-colors",children:(0,F.jsx)(m.A,{className:"h-4 w-4"})}),(0,F.jsx)("button",{onClick:s=>{s.stopPropagation(),(async e=>{if(window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u7b14\u8bb0\u5417\uff1f"))try{await f(e),S()}catch(s){console.error("\u5220\u9664\u7b14\u8bb0\u5931\u8d25:",s)}})(e._id)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",children:(0,F.jsx)(p.A,{className:"h-4 w-4"})})]})]}),(0,F.jsxs)("p",{className:"text-gray-600 text-sm line-clamp-3 mb-4",children:[e.content.replace(/[#*`]/g,"").substring(0,150),"..."]}),(0,F.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,F.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat((s=e.category,{"\u8bfe\u5802\u7b14\u8bb0":"bg-blue-100 text-blue-800","\u590d\u4e60\u603b\u7ed3":"bg-purple-100 text-purple-800","\u77e5\u8bc6\u70b9\u6574\u7406":"bg-indigo-100 text-indigo-800","\u9519\u9898\u96c6":"bg-red-100 text-red-800","\u5176\u4ed6":"bg-gray-100 text-gray-800"}[s]||"bg-gray-100 text-gray-800")),children:e.category}),(0,F.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(P(e.difficulty)),children:e.difficulty}),e.tags.slice(0,2).map((e,s)=>(0,F.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:["#",e]},s)),e.tags.length>2&&(0,F.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:["+",e.tags.length-2]})]}),(0,F.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(u.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:e.viewCount||0})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(h.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:e.likeCount||0})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(n.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()})]})]}),(0,F.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,F.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:e.subject})})]},e._id);var s})}),w>1&&(0,F.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,F.jsx)("button",{onClick:()=>v(Math.max(1,N-1)),disabled:1===N,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0a\u4e00\u9875"}),(0,F.jsxs)("span",{className:"px-3 py-2 text-sm font-medium text-gray-700",children:[N," / ",w]}),(0,F.jsx)("button",{onClick:()=>v(Math.min(w,N+1)),disabled:N===w,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0b\u4e00\u9875"})]}),(0,F.jsx)(z,{isOpen:y,onClose:()=>{b(!1),g(null),S()},note:d})]})};var I=t(41435),q=t(22896),G=t(88348);const L=e=>{let{isOpen:s,onClose:t}=e;const[l,r]=(0,a.useState)(null),[i,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),{register:x,handleSubmit:m,reset:p,formState:{errors:u}}=(0,_.mN)({defaultValues:{isPublic:!0,difficulty:"\u57fa\u7840",category:"\u8bfe\u4ef6"}}),h=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/markdown"],g=e=>{h.includes(e.type)?e.size>10485760?alert("\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 10MB\u3002"):r(e):alert("\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u7c7b\u578b\u3002\u8bf7\u4e0a\u4f20 PDF\u3001Word\u3001Excel\u3001PowerPoint\u3001\u6587\u672c\u6216 Markdown \u6587\u4ef6\u3002")},j=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?d(!0):"dragleave"===e.type&&d(!1)},y=()=>{i||(p(),r(null),t())};return(0,F.jsxs)(M.lG,{open:s,onClose:y,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(M.lG.Panel,{className:"mx-auto max-w-2xl w-full bg-white rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,F.jsx)(M.lG.Title,{className:"text-lg font-semibold text-gray-900",children:"\u4e0a\u4f20\u5b66\u4e60\u8d44\u6599"}),(0,F.jsx)("button",{onClick:y,disabled:i,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,F.jsx)(O.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:m(async e=>{if(l)try{n(!0);const s=new FormData;s.append("file",l),s.append("title",e.title),s.append("description",e.description),s.append("subject",e.subject),s.append("category",e.category),s.append("difficulty",e.difficulty),s.append("isPublic",e.isPublic.toString());const a=e.tags.split(",").map(e=>e.trim()).filter(e=>e.length>0);s.append("tags",JSON.stringify(a)),await v(s),p(),r(null),t()}catch(s){console.error("\u4e0a\u4f20\u5931\u8d25:",s),alert("\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{n(!1)}else alert("\u8bf7\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u6587\u4ef6")}),className:"p-6 space-y-6",children:[(0,F.jsxs)("div",{className:"space-y-4",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u9009\u62e9\u6587\u4ef6 *"}),l?(0,F.jsx)("div",{className:"border border-gray-300 rounded-lg p-4",children:(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)("div",{className:"text-2xl",children:(e=>{const s=e.type;return s.includes("pdf")?"\ud83d\udcc4":s.includes("word")||s.includes("document")?"\ud83d\udcdd":s.includes("excel")||s.includes("spreadsheet")?"\ud83d\udcca":s.includes("powerpoint")||s.includes("presentation")?"\ud83d\udcfd\ufe0f":s.includes("text")?"\ud83d\udcc3":"\ud83d\udcc1"})(l)}),(0,F.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,F.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:l.name}),(0,F.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(l.size)})]}),(0,F.jsx)("button",{type:"button",onClick:()=>r(null),className:"text-gray-400 hover:text-red-600",children:(0,F.jsx)(O.A,{className:"h-5 w-5"})})]})}):(0,F.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(c?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-gray-400"),onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:e=>{e.preventDefault(),e.stopPropagation(),d(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&g(e.dataTransfer.files[0])},children:[(0,F.jsx)(G.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,F.jsxs)("div",{className:"mt-4",children:[(0,F.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[(0,F.jsx)("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"\u70b9\u51fb\u4e0a\u4f20\u6216\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u5904"}),(0,F.jsx)("input",{id:"file-upload",type:"file",className:"sr-only",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md",onChange:e=>{e.target.files&&e.target.files[0]&&g(e.target.files[0])}})]}),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"\u652f\u6301 PDF\u3001Word\u3001Excel\u3001PowerPoint\u3001\u6587\u672c\u6587\u4ef6\uff0c\u6700\u5927 10MB"})]})]})]}),(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,F.jsxs)("div",{className:"md:col-span-2",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u8d44\u6599\u6807\u9898 *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"text"},x("title",{required:"\u8bf7\u8f93\u5165\u8d44\u6599\u6807\u9898"})),{},{className:"input-field",placeholder:"\u8f93\u5165\u8d44\u6599\u6807\u9898"})),u.title&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.title.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u79d1\u76ee *"}),(0,F.jsx)("select",(0,o.A)((0,o.A)({},x("subject",{required:"\u8bf7\u9009\u62e9\u79d1\u76ee"})),{},{className:"input-field",children:["\u6570\u5b66","\u82f1\u8bed","\u8ba1\u7b97\u673a","\u7269\u7406","\u5316\u5b66","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))})),u.subject&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.subject.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5206\u7c7b *"}),(0,F.jsx)("select",(0,o.A)((0,o.A)({},x("category",{required:"\u8bf7\u9009\u62e9\u5206\u7c7b"})),{},{className:"input-field",children:["\u8bfe\u4ef6","\u6559\u6750","\u4e60\u9898\u96c6","\u53c2\u8003\u8d44\u6599","\u89c6\u9891\u6559\u7a0b","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))})),u.category&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.category.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u96be\u5ea6\u7b49\u7ea7"}),(0,F.jsx)("select",(0,o.A)((0,o.A)({},x("difficulty")),{},{className:"input-field",children:["\u5165\u95e8","\u57fa\u7840","\u4e2d\u7ea7","\u9ad8\u7ea7"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))}))]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u6807\u7b7e"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"text"},x("tags")),{},{className:"input-field",placeholder:"\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e"})),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"\u4f8b\u5982\uff1a\u671f\u672b\u590d\u4e60,\u91cd\u70b9\u5185\u5bb9,\u516c\u5f0f\u603b\u7ed3"})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u8d44\u6599\u63cf\u8ff0"}),(0,F.jsx)("textarea",(0,o.A)((0,o.A)({},x("description")),{},{rows:3,className:"input-field",placeholder:"\u7b80\u8981\u63cf\u8ff0\u8fd9\u4e2a\u8d44\u6599\u7684\u5185\u5bb9\u548c\u7528\u9014"}))]}),(0,F.jsxs)("div",{className:"flex items-center",children:[(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"checkbox"},x("isPublic")),{},{className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"})),(0,F.jsx)("label",{className:"ml-2 block text-sm text-gray-900",children:"\u516c\u5f00\u8d44\u6599\uff08\u5176\u4ed6\u7528\u6237\u53ef\u4ee5\u67e5\u770b\u548c\u4e0b\u8f7d\uff09"})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,F.jsx)("button",{type:"button",onClick:y,disabled:i,className:"btn-secondary",children:"\u53d6\u6d88"}),(0,F.jsx)("button",{type:"submit",disabled:i||!l,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,F.jsx)("span",{children:"\u4e0a\u4f20\u4e2d..."})]}):"\u4e0a\u4f20\u8d44\u6599"})]})]})]})})]})},H=e=>{let{searchTerm:s}=e;const[t,l]=(0,a.useState)([]),[r,i]=(0,a.useState)(!0),[n,c]=(0,a.useState)(!1),[d,m]=(0,a.useState)(1),[u,h]=(0,a.useState)(1),[g,j]=(0,a.useState)({subject:"",category:"",difficulty:""}),y=async()=>{try{i(!0);if(!localStorage.getItem("token"))return console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u83b7\u53d6\u5b66\u4e60\u8d44\u6599"),void l([]);const e=await N((0,o.A)({page:d,limit:12,search:s},g));l(e.data),e.pagination&&h(e.pagination.pages)}catch(a){var e,t;console.error("\u83b7\u53d6\u8d44\u6599\u5931\u8d25:",a),"NETWORK_ERROR"!==(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.error)&&401!==(null===a||void 0===a||null===(t=a.response)||void 0===t?void 0:t.status)||(console.log("\u8ba4\u8bc1\u5931\u8d25\uff0c\u7528\u6237\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u767b\u5f55"),l([]))}finally{i(!1)}};(0,a.useEffect)(()=>{y()},[d,s,g]);const b=()=>{c(!0)},f=async e=>{try{const s=await w(e._id),t=window.URL.createObjectURL(s),a=document.createElement("a");a.style.display="none",a.href=t,a.download=e.fileInfo.originalName,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a)}catch(s){console.error("\u4e0b\u8f7d\u5931\u8d25:",s),alert("\u4e0b\u8f7d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}},v=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},k=e=>{switch(e){case"\u5165\u95e8":return"bg-green-100 text-green-800";case"\u57fa\u7840":return"bg-blue-100 text-blue-800";case"\u4e2d\u7ea7":return"bg-yellow-100 text-yellow-800";case"\u9ad8\u7ea7":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return r?(0,F.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[(0,F.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,F.jsxs)("select",{value:g.subject,onChange:e=>j((0,o.A)((0,o.A)({},g),{},{subject:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u79d1\u76ee"}),(0,F.jsx)("option",{value:"\u6570\u5b66",children:"\u6570\u5b66"}),(0,F.jsx)("option",{value:"\u82f1\u8bed",children:"\u82f1\u8bed"}),(0,F.jsx)("option",{value:"\u8ba1\u7b97\u673a",children:"\u8ba1\u7b97\u673a"}),(0,F.jsx)("option",{value:"\u7269\u7406",children:"\u7269\u7406"}),(0,F.jsx)("option",{value:"\u5316\u5b66",children:"\u5316\u5b66"})]}),(0,F.jsxs)("select",{value:g.category,onChange:e=>j((0,o.A)((0,o.A)({},g),{},{category:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u5206\u7c7b"}),["\u8bfe\u4ef6","\u6559\u6750","\u4e60\u9898\u96c6","\u53c2\u8003\u8d44\u6599","\u89c6\u9891\u6559\u7a0b","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]}),(0,F.jsxs)("select",{value:g.difficulty,onChange:e=>j((0,o.A)((0,o.A)({},g),{},{difficulty:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u96be\u5ea6"}),["\u5165\u95e8","\u57fa\u7840","\u4e2d\u7ea7","\u9ad8\u7ea7"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]})]}),(0,F.jsxs)("button",{onClick:b,className:"btn-primary flex items-center space-x-2",children:[(0,F.jsx)(x.A,{className:"h-5 w-5"}),(0,F.jsx)("span",{children:"\u4e0a\u4f20\u8d44\u6599"})]})]}),0===t.length?(0,F.jsxs)("div",{className:"text-center py-12",children:[(0,F.jsx)(I.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,F.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"\u6682\u65e0\u5b66\u4e60\u8d44\u6599"}),(0,F.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"\u4e0a\u4f20\u4f60\u7684\u7b2c\u4e00\u4e2a\u5b66\u4e60\u8d44\u6599\u5427\uff01"}),(0,F.jsx)("div",{className:"mt-6",children:(0,F.jsxs)("button",{onClick:b,className:"btn-primary",children:[(0,F.jsx)(x.A,{className:"h-5 w-5 mr-2"}),"\u4e0a\u4f20\u8d44\u6599"]})})]}):(0,F.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{return(0,F.jsxs)("div",{className:"card hover:shadow-md transition-shadow duration-200",children:[(0,F.jsxs)("div",{className:"flex items-start space-x-3 mb-4",children:[(0,F.jsx)("div",{className:"text-3xl",children:(t=e.fileInfo.mimetype,t.includes("pdf")?"\ud83d\udcc4":t.includes("word")||t.includes("document")?"\ud83d\udcdd":t.includes("excel")||t.includes("spreadsheet")?"\ud83d\udcca":t.includes("powerpoint")||t.includes("presentation")?"\ud83d\udcfd\ufe0f":t.includes("text")?"\ud83d\udcc3":"\ud83d\udcc1")}),(0,F.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 line-clamp-2",children:e.title}),(0,F.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.fileInfo.originalName}),(0,F.jsx)("p",{className:"text-xs text-gray-400",children:v(e.fileInfo.size)})]}),(0,F.jsxs)("div",{className:"flex space-x-1",children:[(0,F.jsx)("button",{onClick:()=>f(e),className:"p-1 text-gray-400 hover:text-primary-600 transition-colors",title:"\u4e0b\u8f7d",children:(0,F.jsx)(q.A,{className:"h-4 w-4"})}),(0,F.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u8d44\u6599\u5417\uff1f"))try{await A(e),y()}catch(s){console.error("\u5220\u9664\u8d44\u6599\u5931\u8d25:",s)}})(e._id),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"\u5220\u9664",children:(0,F.jsx)(p.A,{className:"h-4 w-4"})})]})]}),e.description&&(0,F.jsx)("p",{className:"text-gray-600 text-sm line-clamp-2 mb-4",children:e.description}),(0,F.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,F.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat((s=e.category,{"\u8bfe\u4ef6":"bg-blue-100 text-blue-800","\u6559\u6750":"bg-purple-100 text-purple-800","\u4e60\u9898\u96c6":"bg-orange-100 text-orange-800","\u53c2\u8003\u8d44\u6599":"bg-indigo-100 text-indigo-800","\u89c6\u9891\u6559\u7a0b":"bg-pink-100 text-pink-800","\u5176\u4ed6":"bg-gray-100 text-gray-800"}[s]||"bg-gray-100 text-gray-800")),children:e.category}),(0,F.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(k(e.difficulty)),children:e.difficulty}),e.tags.slice(0,2).map((e,s)=>(0,F.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:["#",e]},s)),e.tags.length>2&&(0,F.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:["+",e.tags.length-2]})]}),(0,F.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-3",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)(q.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:e.downloadCount||0})]}),e.rating&&e.rating.count>0&&(0,F.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,F.jsx)("span",{children:"\u2b50"}),(0,F.jsx)("span",{children:e.rating.average.toFixed(1)}),(0,F.jsxs)("span",{children:["(",e.rating.count,")"]})]})]}),(0,F.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()})]}),(0,F.jsxs)("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200",children:[(0,F.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800",children:e.subject}),(0,F.jsx)("button",{onClick:()=>f(e),className:"btn-secondary text-xs py-1 px-3",children:"\u4e0b\u8f7d"})]})]},e._id);var s,t})}),u>1&&(0,F.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,F.jsx)("button",{onClick:()=>m(Math.max(1,d-1)),disabled:1===d,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0a\u4e00\u9875"}),(0,F.jsxs)("span",{className:"px-3 py-2 text-sm font-medium text-gray-700",children:[d," / ",u]}),(0,F.jsx)("button",{onClick:()=>m(Math.min(u,d+1)),disabled:d===u,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0b\u4e00\u9875"})]}),(0,F.jsx)(L,{isOpen:n,onClose:()=>{c(!1),y()}})]})};var $=t(75516),K=t(70213),W=t(36923),U=t(2765),V=t(48505),J=t(85211);const Q=e=>{let{isOpen:s,onClose:t,plan:l}=e;const[r,i]=(0,a.useState)(!1),n=!!l,{register:c,handleSubmit:d,reset:m,control:u,watch:h,formState:{errors:g}}=(0,_.mN)({defaultValues:{priority:"\u4e2d",type:"\u5b66\u4e60\u8ba1\u5212",tasks:[{title:"",completed:!1}],reminders:[]}}),{fields:j,append:y,remove:b}=(0,_.jz)({control:u,name:"tasks"}),{fields:f,append:N,remove:v}=(0,_.jz)({control:u,name:"reminders"}),w=h("startDate");h("endDate");(0,a.useEffect)(()=>{if(l){const e={title:l.title,description:l.description||"",subject:l.subject||"",type:l.type,priority:l.priority,startDate:l.startDate.split("T")[0],endDate:l.endDate.split("T")[0],estimatedHours:l.estimatedHours,tasks:l.tasks&&l.tasks.length>0?l.tasks.map(e=>({title:e.title,completed:e.isCompleted})):[{title:"",completed:!1}],reminders:l.reminders||[],tags:l.tags?l.tags.join(", "):"",notes:l.notes||""};m(e)}else m({priority:"\u4e2d",type:"\u5b66\u4e60\u8ba1\u5212",tasks:[{title:"",completed:!1}],reminders:[],startDate:(new Date).toISOString().split("T")[0],endDate:new Date(Date.now()+6048e5).toISOString().split("T")[0]})},[l,m]);const A=()=>{r||t()};return(0,F.jsxs)(M.lG,{open:s,onClose:A,className:"relative z-50",children:[(0,F.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,F.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,F.jsxs)(M.lG.Panel,{className:"mx-auto max-w-4xl w-full bg-white rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,F.jsx)(M.lG.Title,{className:"text-lg font-semibold text-gray-900",children:n?"\u7f16\u8f91\u5b66\u4e60\u8ba1\u5212":"\u65b0\u5efa\u5b66\u4e60\u8ba1\u5212"}),(0,F.jsx)("button",{onClick:A,disabled:r,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,F.jsx)(O.A,{className:"h-6 w-6"})})]}),(0,F.jsxs)("form",{onSubmit:d(async e=>{try{i(!0);const s=e.tags.split(",").map(e=>e.trim()).filter(e=>e.length>0),a=e.tasks.filter(e=>e.title.trim().length>0),r=e.reminders.filter(e=>e.date&&e.message.trim().length>0),c={title:e.title,description:e.description,subject:e.subject,type:e.type,priority:e.priority,status:n&&(null===l||void 0===l?void 0:l.status)||"\u672a\u5f00\u59cb",progress:0,startDate:e.startDate,endDate:e.endDate,estimatedHours:e.estimatedHours,tasks:a.map(e=>({title:e.title,isCompleted:e.completed||!1,estimatedMinutes:30})),tags:s,reminders:r.map(e=>({date:e.date,message:e.message,isActive:!0,isSent:!1})),notes:e.notes};n?await S(l._id,c):await C(c),t()}catch(s){console.error("\u4fdd\u5b58\u5b66\u4e60\u8ba1\u5212\u5931\u8d25:",s),alert("\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{i(!1)}}),className:"p-6 space-y-6",children:[(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,F.jsxs)("div",{className:"md:col-span-2",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u8ba1\u5212\u6807\u9898 *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"text"},c("title",{required:"\u8bf7\u8f93\u5165\u8ba1\u5212\u6807\u9898"})),{},{className:"input-field",placeholder:"\u8f93\u5165\u5b66\u4e60\u8ba1\u5212\u6807\u9898"})),g.title&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.title.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u8ba1\u5212\u7c7b\u578b *"}),(0,F.jsx)("select",(0,o.A)((0,o.A)({},c("type",{required:"\u8bf7\u9009\u62e9\u8ba1\u5212\u7c7b\u578b"})),{},{className:"input-field",children:["\u5b66\u4e60\u8ba1\u5212","\u590d\u4e60\u8ba1\u5212","\u9879\u76ee\u8ba1\u5212","\u8003\u8bd5\u51c6\u5907","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))})),g.type&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.type.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u4f18\u5148\u7ea7 *"}),(0,F.jsx)("select",(0,o.A)((0,o.A)({},c("priority",{required:"\u8bf7\u9009\u62e9\u4f18\u5148\u7ea7"})),{},{className:"input-field ".concat((e=>{switch(e){case"\u4f4e":return"border-green-300 bg-green-50";case"\u4e2d":return"border-yellow-300 bg-yellow-50";case"\u9ad8":return"border-orange-300 bg-orange-50";case"\u7d27\u6025":return"border-red-300 bg-red-50";default:return"border-gray-300 bg-gray-50"}})(h("priority"))),children:["\u4f4e","\u4e2d","\u9ad8","\u7d27\u6025"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))})),g.priority&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.priority.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u76f8\u5173\u79d1\u76ee"}),(0,F.jsxs)("select",(0,o.A)((0,o.A)({},c("subject")),{},{className:"input-field",children:[(0,F.jsx)("option",{value:"",children:"\u9009\u62e9\u79d1\u76ee"}),["\u6570\u5b66","\u82f1\u8bed","\u8ba1\u7b97\u673a","\u7269\u7406","\u5316\u5b66","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]}))]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u9884\u8ba1\u65f6\u957f\uff08\u5c0f\u65f6\uff09 *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"number",min:"1",step:"0.5"},c("estimatedHours",{required:"\u8bf7\u8f93\u5165\u9884\u8ba1\u65f6\u957f",min:{value:.5,message:"\u65f6\u957f\u81f3\u5c11\u4e3a0.5\u5c0f\u65f6"}})),{},{className:"input-field",placeholder:"\u4f8b\u5982\uff1a10"})),g.estimatedHours&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.estimatedHours.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5f00\u59cb\u65e5\u671f *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"date"},c("startDate",{required:"\u8bf7\u9009\u62e9\u5f00\u59cb\u65e5\u671f"})),{},{className:"input-field"})),g.startDate&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.startDate.message})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u7ed3\u675f\u65e5\u671f *"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"date",min:w},c("endDate",{required:"\u8bf7\u9009\u62e9\u7ed3\u675f\u65e5\u671f",validate:e=>!(w&&e<w)||"\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u65e9\u4e8e\u5f00\u59cb\u65e5\u671f"})),{},{className:"input-field"})),g.endDate&&(0,F.jsx)("p",{className:"mt-1 text-sm text-red-600",children:g.endDate.message})]})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u8ba1\u5212\u63cf\u8ff0"}),(0,F.jsx)("textarea",(0,o.A)((0,o.A)({},c("description")),{},{rows:3,className:"input-field",placeholder:"\u8be6\u7ec6\u63cf\u8ff0\u8fd9\u4e2a\u5b66\u4e60\u8ba1\u5212\u7684\u76ee\u6807\u548c\u5185\u5bb9"}))]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u4efb\u52a1\u6e05\u5355"}),(0,F.jsxs)("button",{type:"button",onClick:()=>{y({title:"",completed:!1})},className:"btn-secondary text-sm py-1 px-3 flex items-center space-x-1",children:[(0,F.jsx)(x.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:"\u6dfb\u52a0\u4efb\u52a1"})]})]}),(0,F.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:j.map((e,s)=>(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"text"},c("tasks.".concat(s,".title"))),{},{className:"input-field flex-1",placeholder:"\u4efb\u52a1 ".concat(s+1)})),j.length>1&&(0,F.jsx)("button",{type:"button",onClick:()=>b(s),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:(0,F.jsx)(p.A,{className:"h-4 w-4"})})]},e.id))})]}),(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u63d0\u9192\u8bbe\u7f6e"}),(0,F.jsxs)("button",{type:"button",onClick:()=>{N({date:"",message:""})},className:"btn-secondary text-sm py-1 px-3 flex items-center space-x-1",children:[(0,F.jsx)(x.A,{className:"h-4 w-4"}),(0,F.jsx)("span",{children:"\u6dfb\u52a0\u63d0\u9192"})]})]}),(0,F.jsxs)("div",{className:"space-y-3 max-h-48 overflow-y-auto",children:[f.map((e,s)=>(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"datetime-local"},c("reminders.".concat(s,".date"))),{},{className:"input-field w-48"})),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"text"},c("reminders.".concat(s,".message"))),{},{className:"input-field flex-1",placeholder:"\u63d0\u9192\u5185\u5bb9"})),(0,F.jsx)("button",{type:"button",onClick:()=>v(s),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:(0,F.jsx)(p.A,{className:"h-4 w-4"})})]},e.id)),0===f.length&&(0,F.jsx)("p",{className:"text-sm text-gray-500 italic",children:"\u6682\u65e0\u63d0\u9192\u8bbe\u7f6e\uff0c\u70b9\u51fb\u4e0a\u65b9\u6309\u94ae\u6dfb\u52a0\u63d0\u9192"})]})]}),(0,F.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u6807\u7b7e"}),(0,F.jsx)("input",(0,o.A)((0,o.A)({type:"text"},c("tags")),{},{className:"input-field",placeholder:"\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e"})),(0,F.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"\u4f8b\u5982\uff1a\u671f\u672b\u590d\u4e60,\u91cd\u8981,\u6570\u5b66"})]}),(0,F.jsxs)("div",{children:[(0,F.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5907\u6ce8"}),(0,F.jsx)("textarea",(0,o.A)((0,o.A)({},c("notes")),{},{rows:3,className:"input-field",placeholder:"\u5176\u4ed6\u5907\u6ce8\u4fe1\u606f"}))]})]}),(0,F.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[(0,F.jsx)("button",{type:"button",onClick:A,disabled:r,className:"btn-secondary",children:"\u53d6\u6d88"}),(0,F.jsx)("button",{type:"submit",disabled:r,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:r?(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,F.jsx)("span",{children:"\u4fdd\u5b58\u4e2d..."})]}):n?"\u66f4\u65b0\u8ba1\u5212":"\u521b\u5efa\u8ba1\u5212"})]})]})]})})]})},X=e=>{let{searchTerm:s}=e;const[t,l]=(0,a.useState)([]),[r,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null),[g,j]=(0,a.useState)(1),[y,b]=(0,a.useState)(1),[f,N]=(0,a.useState)({status:"",priority:"",type:""}),v=async()=>{try{i(!0);if(!localStorage.getItem("token"))return console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u83b7\u53d6\u5b66\u4e60\u8ba1\u5212"),void l([]);const e=await k((0,o.A)({page:g,limit:10,search:s},f));l(e.data),e.pagination&&b(e.pagination.pages)}catch(a){var e,t;console.error("\u83b7\u53d6\u5b66\u4e60\u8ba1\u5212\u5931\u8d25:",a),"NETWORK_ERROR"!==(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.error)&&401!==(null===a||void 0===a||null===(t=a.response)||void 0===t?void 0:t.status)||(console.log("\u8ba4\u8bc1\u5931\u8d25\uff0c\u7528\u6237\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u767b\u5f55"),l([]))}finally{i(!1)}};(0,a.useEffect)(()=>{v()},[g,s,f]);const w=()=>{h(null),d(!0)},A=async(e,s)=>{try{await S(e,{status:s}),v()}catch(t){console.error("\u66f4\u65b0\u72b6\u6001\u5931\u8d25:",t)}},C=e=>{switch(e){case"\u672a\u5f00\u59cb":default:return"bg-gray-100 text-gray-800";case"\u8fdb\u884c\u4e2d":return"bg-blue-100 text-blue-800";case"\u5df2\u5b8c\u6210":return"bg-green-100 text-green-800";case"\u5df2\u6682\u505c":return"bg-yellow-100 text-yellow-800";case"\u5df2\u53d6\u6d88":return"bg-red-100 text-red-800"}},P=e=>{switch(e){case"\u4f4e":return"bg-green-100 text-green-800";case"\u4e2d":return"bg-yellow-100 text-yellow-800";case"\u9ad8":return"bg-orange-100 text-orange-800";case"\u7d27\u6025":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"});return r?(0,F.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,F.jsxs)("div",{className:"space-y-6",children:[(0,F.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0",children:[(0,F.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,F.jsxs)("select",{value:f.status,onChange:e=>N((0,o.A)((0,o.A)({},f),{},{status:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u72b6\u6001"}),["\u672a\u5f00\u59cb","\u8fdb\u884c\u4e2d","\u5df2\u5b8c\u6210","\u5df2\u6682\u505c","\u5df2\u53d6\u6d88"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]}),(0,F.jsxs)("select",{value:f.priority,onChange:e=>N((0,o.A)((0,o.A)({},f),{},{priority:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u4f18\u5148\u7ea7"}),["\u4f4e","\u4e2d","\u9ad8","\u7d27\u6025"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]}),(0,F.jsxs)("select",{value:f.type,onChange:e=>N((0,o.A)((0,o.A)({},f),{},{type:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,F.jsx)("option",{value:"",children:"\u6240\u6709\u7c7b\u578b"}),["\u5b66\u4e60\u8ba1\u5212","\u590d\u4e60\u8ba1\u5212","\u9879\u76ee\u8ba1\u5212","\u8003\u8bd5\u51c6\u5907","\u5176\u4ed6"].map(e=>(0,F.jsx)("option",{value:e,children:e},e))]})]}),(0,F.jsxs)("button",{onClick:w,className:"btn-primary flex items-center space-x-2",children:[(0,F.jsx)(x.A,{className:"h-5 w-5"}),(0,F.jsx)("span",{children:"\u65b0\u5efa\u8ba1\u5212"})]})]}),0===t.length?(0,F.jsxs)("div",{className:"text-center py-12",children:[(0,F.jsx)(n.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,F.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"\u6682\u65e0\u5b66\u4e60\u8ba1\u5212"}),(0,F.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"\u521b\u5efa\u4f60\u7684\u7b2c\u4e00\u4e2a\u5b66\u4e60\u8ba1\u5212\u5427\uff01"}),(0,F.jsx)("div",{className:"mt-6",children:(0,F.jsxs)("button",{onClick:w,className:"btn-primary",children:[(0,F.jsx)(x.A,{className:"h-5 w-5 mr-2"}),"\u65b0\u5efa\u8ba1\u5212"]})})]}):(0,F.jsx)("div",{className:"space-y-4",children:t.map(e=>{const s=(t=e.tasks)&&0!==t.length?{completed:t.filter(e=>e.isCompleted).length,total:t.length}:{completed:0,total:0};var t;const a=(l=e.endDate,"\u5df2\u5b8c\u6210"!==(r=e.status)&&"\u5df2\u53d6\u6d88"!==r&&new Date(l)<new Date);var l,r,i;return(0,F.jsxs)("div",{className:"card hover:shadow-md transition-shadow duration-200 ".concat(a?"border-l-4 border-red-500":""),children:[(0,F.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,F.jsxs)("div",{className:"flex-1",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.title}),a&&(0,F.jsx)($.A,{className:"h-5 w-5 text-red-500",title:"\u5df2\u903e\u671f"})]}),(0,F.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[(0,F.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(C(e.status)),children:e.status}),(0,F.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(P(e.priority)),children:[e.priority,"\u4f18\u5148\u7ea7"]}),(0,F.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:e.type}),e.subject&&(0,F.jsx)("span",{className:"px-2 py-1 bg-primary-100 text-primary-800 rounded-full text-xs",children:e.subject})]}),e.description&&(0,F.jsx)("p",{className:"text-gray-600 text-sm line-clamp-2",children:e.description})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,F.jsx)("button",{onClick:()=>(e=>{h(e),d(!0)})(e),className:"p-2 text-gray-400 hover:text-primary-600 transition-colors",title:"\u7f16\u8f91",children:(0,F.jsx)(m.A,{className:"h-4 w-4"})}),(0,F.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5b66\u4e60\u8ba1\u5212\u5417\uff1f"))try{await T(e),v()}catch(s){console.error("\u5220\u9664\u5b66\u4e60\u8ba1\u5212\u5931\u8d25:",s)}})(e._id),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"\u5220\u9664",children:(0,F.jsx)(p.A,{className:"h-4 w-4"})})]})]}),(0,F.jsxs)("div",{className:"mb-4",children:[(0,F.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,F.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"\u8fdb\u5ea6"}),(0,F.jsxs)("span",{className:"text-sm text-gray-500",children:[e.progress,"%"]})]}),(0,F.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,F.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 ".concat((i=e.progress,i>=80?"bg-green-500":i>=60?"bg-blue-500":i>=40?"bg-yellow-500":i>=20?"bg-orange-500":"bg-red-500")),style:{width:"".concat(e.progress,"%")}})})]}),(0,F.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 text-sm",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(n.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-gray-500",children:"\u5f00\u59cb\u65e5\u671f"}),(0,F.jsx)("p",{className:"font-medium",children:E(e.startDate)})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(K.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-gray-500",children:"\u7ed3\u675f\u65e5\u671f"}),(0,F.jsx)("p",{className:"font-medium ".concat(a?"text-red-600":""),children:E(e.endDate)})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(W.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-gray-500",children:"\u9884\u8ba1\u65f6\u957f"}),(0,F.jsxs)("p",{className:"font-medium",children:[e.estimatedHours,"\u5c0f\u65f6"]})]})]}),(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,F.jsx)(U.A,{className:"h-4 w-4 text-gray-400"}),(0,F.jsxs)("div",{children:[(0,F.jsx)("p",{className:"text-gray-500",children:"\u4efb\u52a1\u8fdb\u5ea6"}),(0,F.jsxs)("p",{className:"font-medium",children:[s.completed,"/",s.total]})]})]})]}),e.tasks&&e.tasks.length>0&&(0,F.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,F.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"\u4efb\u52a1\u6e05\u5355"}),(0,F.jsxs)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[e.tasks.slice(0,5).map((s,t)=>(0,F.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,F.jsx)("button",{onClick:()=>(async(e,s)=>{try{await D(e,{taskIndex:s}),v()}catch(t){console.error("\u66f4\u65b0\u4efb\u52a1\u72b6\u6001\u5931\u8d25:",t)}})(e._id,t),className:"flex-shrink-0 h-4 w-4 rounded border-2 flex items-center justify-center transition-colors ".concat(s.isCompleted?"bg-green-500 border-green-500 text-white":"border-gray-300 hover:border-green-500"),children:s.isCompleted&&(0,F.jsx)(U.A,{className:"h-3 w-3"})}),(0,F.jsx)("span",{className:"text-sm flex-1 ".concat(s.isCompleted?"line-through text-gray-500":"text-gray-700"),children:s.title})]},t)),e.tasks.length>5&&(0,F.jsxs)("p",{className:"text-xs text-gray-500 pl-7",children:["\u8fd8\u6709 ",e.tasks.length-5," \u4e2a\u4efb\u52a1..."]})]})]}),(0,F.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 mt-4",children:[(0,F.jsxs)("div",{className:"flex items-center space-x-2",children:["\u672a\u5f00\u59cb"===e.status&&(0,F.jsxs)("button",{onClick:()=>A(e._id,"\u8fdb\u884c\u4e2d"),className:"btn-secondary text-xs py-1 px-3 flex items-center space-x-1",children:[(0,F.jsx)(V.A,{className:"h-3 w-3"}),(0,F.jsx)("span",{children:"\u5f00\u59cb"})]}),"\u8fdb\u884c\u4e2d"===e.status&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("button",{onClick:()=>A(e._id,"\u5df2\u53d6\u6d88"),className:"btn-secondary text-xs py-1 px-3 flex items-center space-x-1",children:[(0,F.jsx)(J.A,{className:"h-3 w-3"}),(0,F.jsx)("span",{children:"\u53d6\u6d88"})]}),(0,F.jsxs)("button",{onClick:()=>A(e._id,"\u5df2\u5b8c\u6210"),className:"btn-primary text-xs py-1 px-3 flex items-center space-x-1",children:[(0,F.jsx)(U.A,{className:"h-3 w-3"}),(0,F.jsx)("span",{children:"\u5b8c\u6210"})]})]}),"\u8fdb\u884c\u4e2d"===e.status&&(0,F.jsxs)("button",{onClick:()=>A(e._id,"\u5df2\u5b8c\u6210"),className:"btn-primary text-xs py-1 px-3 flex items-center space-x-1",children:[(0,F.jsx)(U.A,{className:"h-3 w-3"}),(0,F.jsx)("span",{children:"\u5b8c\u6210"})]})]}),(0,F.jsxs)("div",{className:"text-xs text-gray-500",children:["\u521b\u5efa\u4e8e ",E(e.createdAt)]})]})]},e._id)})}),y>1&&(0,F.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,F.jsx)("button",{onClick:()=>j(Math.max(1,g-1)),disabled:1===g,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0a\u4e00\u9875"}),(0,F.jsxs)("span",{className:"px-3 py-2 text-sm font-medium text-gray-700",children:[g," / ",y]}),(0,F.jsx)("button",{onClick:()=>j(Math.min(y,g+1)),disabled:g===y,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0b\u4e00\u9875"})]}),(0,F.jsx)(Q,{isOpen:c,onClose:()=>{d(!1),h(null),v()},plan:u})]})};class Y extends a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("ErrorBoundary caught an error:",e,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,F.jsx)("div",{className:"min-h-[400px] flex items-center justify-center bg-gray-50 rounded-lg border border-gray-200",children:(0,F.jsxs)("div",{className:"text-center p-8",children:[(0,F.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"\u51fa\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898"}),(0,F.jsx)("p",{className:"text-gray-600 mb-4",children:"\u9875\u9762\u52a0\u8f7d\u65f6\u9047\u5230\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5"}),(0,F.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\u5237\u65b0\u9875\u9762"})]})}):this.props.children}}const Z=Y;var ee=t(64112);const se=e=>{let{message:s="\u8bf7\u5148\u767b\u5f55\u4ee5\u8bbf\u95ee\u6b64\u529f\u80fd"}=e;return(0,F.jsx)("div",{className:"min-h-[400px] flex items-center justify-center bg-gray-50 rounded-lg border border-gray-200",children:(0,F.jsxs)("div",{className:"text-center p-8 max-w-md",children:[(0,F.jsx)("div",{className:"text-blue-500 text-6xl mb-4",children:(0,F.jsx)(ee.A,{className:"h-16 w-16 mx-auto"})}),(0,F.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"\u9700\u8981\u767b\u5f55"}),(0,F.jsx)("p",{className:"text-gray-600 mb-6",children:s}),(0,F.jsx)("button",{onClick:()=>{window.location.href="/login"},className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"\u524d\u5f80\u767b\u5f55"})]})})};function te(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter(Boolean).join(" ")}const ae=()=>{const[e,s]=(0,a.useState)(0),[t,o]=(0,a.useState)([]),[x,m]=(0,a.useState)(""),[p,u]=(0,a.useState)(!0),[h,g]=(0,a.useState)(!1),j=[{name:"\u5b66\u4e60\u7b14\u8bb0",icon:r.A,component:B},{name:"\u5b66\u4e60\u8d44\u6599",icon:i.A,component:H},{name:"\u5b66\u4e60\u8ba1\u5212",icon:n.A,component:X}];return(0,a.useEffect)(()=>{(async()=>{try{u(!0);if(!localStorage.getItem("token"))return console.log("\u7528\u6237\u672a\u767b\u5f55"),g(!1),void o([]);g(!0);const e=new Promise((e,s)=>{setTimeout(()=>s(new Error("\u8bf7\u6c42\u8d85\u65f6")),15e3)}),s=await Promise.race([P(),e]);s&&"object"===typeof s&&"data"in s&&s.data&&o(s.data)}catch(t){var e,s;console.error("\u83b7\u53d6\u63d0\u9192\u5931\u8d25:",t),"NETWORK_ERROR"!==(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.error)&&401!==(null===t||void 0===t||null===(s=t.response)||void 0===s?void 0:s.status)||(console.log("\u8ba4\u8bc1\u5931\u8d25\uff0c\u7528\u6237\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u767b\u5f55"),g(!1)),o([])}finally{u(!1)}})()},[]),p?(0,F.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,F.jsxs)("div",{className:"text-center",children:[(0,F.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,F.jsx)("p",{className:"text-gray-600",children:"\u52a0\u8f7d\u5b66\u4e60\u6570\u636e\u4e2d..."})]})}):h?(0,F.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,F.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,F.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,F.jsxs)("div",{className:"py-6",children:[(0,F.jsxs)("div",{className:"flex items-center justify-between",children:[(0,F.jsxs)("div",{children:[(0,F.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,F.jsx)(c.A,{className:"h-8 w-8 mr-3 text-primary-600"}),"\u5b66\u4e60\u533a"]}),(0,F.jsx)("p",{className:"mt-2 text-gray-600",children:"\u7ba1\u7406\u4f60\u7684\u5b66\u4e60\u7b14\u8bb0\u3001\u8d44\u6599\u548c\u8ba1\u5212"})]}),(0,F.jsx)("div",{className:"flex items-center space-x-4",children:(0,F.jsxs)("div",{className:"relative",children:[(0,F.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,F.jsx)("input",{type:"text",placeholder:"\u641c\u7d22\u5b66\u4e60\u5185\u5bb9...",value:x,onChange:e=>m(e.target.value),className:"pl-10 pr-4 py-2 w-80 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})})]}),t.length>0&&(0,F.jsxs)("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,F.jsx)("h3",{className:"text-sm font-medium text-yellow-800 mb-2",children:"\ud83d\udcc5 \u5373\u5c06\u5230\u671f\u7684\u63d0\u9192"}),(0,F.jsx)("div",{className:"space-y-1",children:t.slice(0,3).map((e,s)=>(0,F.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,F.jsx)("span",{className:"font-medium",children:e.planTitle}),": ",e.message]},s))})]})]})})}),(0,F.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,F.jsxs)(l.oz.Group,{selectedIndex:e,onChange:s,children:[(0,F.jsx)(l.oz.List,{className:"flex space-x-1 rounded-xl bg-primary-100 p-1 mb-8",children:j.map((e,s)=>(0,F.jsx)(l.oz,{className:e=>{let{selected:s}=e;return te("w-full rounded-lg py-2.5 text-sm font-medium leading-5 transition-all duration-200","ring-white ring-opacity-60 ring-offset-2 ring-offset-primary-400 focus:outline-none focus:ring-2",s?"bg-white text-primary-700 shadow":"text-primary-600 hover:bg-white/[0.12] hover:text-primary-700")},children:(0,F.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,F.jsx)(e.icon,{className:"h-5 w-5"}),(0,F.jsx)("span",{children:e.name})]})},e.name))}),(0,F.jsx)(l.oz.Panels,{children:j.map((e,s)=>(0,F.jsx)(l.oz.Panel,{className:te("rounded-xl bg-white p-6 shadow-sm border border-gray-200","ring-white ring-opacity-60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2"),children:(0,F.jsx)(Z,{children:(0,F.jsx)(e.component,{searchTerm:x})})},s))})]})})]}):(0,F.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,F.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,F.jsx)(se,{message:"\u8bf7\u5148\u767b\u5f55\u4ee5\u8bbf\u95ee\u5b66\u4e60\u533a\u529f\u80fd"})})})}}}]);