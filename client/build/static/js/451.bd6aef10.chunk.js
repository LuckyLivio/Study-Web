"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[451],{2765:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80045),l=s(9950);const r=["title","titleId"];function n(e,t){let{title:s,titleId:n}=e,i=(0,a.A)(e,r);return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),s?l.createElement("title",{id:n},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const i=l.forwardRef(n)},15536:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80045),l=s(9950);const r=["title","titleId"];function n(e,t){let{title:s,titleId:n}=e,i=(0,a.A)(e,r);return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),s?l.createElement("title",{id:n},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const i=l.forwardRef(n)},35451:(e,t,s)=>{s.r(t),s.d(t,{default:()=>w});var a=s(9950),l=s(89379),r=s(36923),n=s(75516),i=s(2765),c=s(67844),d=s(57491),o=s(59961),m=s(80045);const x=["title","titleId"];function u(e,t){let{title:s,titleId:l}=e,r=(0,m.A)(e,x);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},r),s?a.createElement("title",{id:l},s):null,a.createElement("path",{d:"m11.645 20.91-.007-.003-.022-.012a15.247 15.247 0 0 1-.383-.218 25.18 25.18 0 0 1-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0 1 12 5.052 5.5 5.5 0 0 1 16.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 0 1-4.244 3.17 15.247 15.247 0 0 1-.383.219l-.022.012-.007.004-.003.001a.752.752 0 0 1-.704 0l-.003-.001Z"}))}const h=a.forwardRef(u);var g=s(82715);const p={getPublicMessages:e=>g.A.get("/messages/public",{params:e}),createMessage:e=>g.A.post("/messages",e),likeMessage:e=>g.A.post("/messages/".concat(e,"/like")),admin:{getAllMessages:e=>g.A.get("/messages/admin",{params:e}),replyMessage:(e,t)=>g.A.post("/messages/".concat(e,"/reply"),{content:t}),updateMessageStatus:(e,t)=>g.A.put("/messages/".concat(e,"/status"),t),deleteMessage:e=>g.A.delete("/messages/".concat(e)),getMessageStats:()=>g.A.get("/messages/stats")}};var b=s(15536),y=s(44414);const j=e=>{let{isOpen:t,onClose:s}=e;const[r,n]=(0,a.useState)({content:"",type:"\u5efa\u8bae",isAnonymous:!0,contactInfo:"",tags:""}),[i,c]=(0,a.useState)(!1),[d,o]=(0,a.useState)(""),m=()=>{i||(n({content:"",type:"\u5efa\u8bae",isAnonymous:!0,contactInfo:"",tags:""}),o(""),s())};return t?(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,y.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"\u5199\u7559\u8a00"}),(0,y.jsx)("button",{onClick:m,disabled:i,className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",children:(0,y.jsx)(b.A,{className:"h-6 w-6"})})]}),(0,y.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),r.content.trim())try{c(!0),o("");const e={content:r.content.trim(),type:r.type,isAnonymous:r.isAnonymous,contactInfo:r.contactInfo.trim()||void 0,tags:r.tags.split(",").map(e=>e.trim()).filter(e=>e),isPublic:!0},t=await p.createMessage(e);t.success?(n({content:"",type:"\u5efa\u8bae",isAnonymous:!0,contactInfo:"",tags:""}),s()):o(t.message||"\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}catch(d){console.error("\u63d0\u4ea4\u7559\u8a00\u5931\u8d25:",d),o("\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}finally{c(!1)}else o("\u8bf7\u8f93\u5165\u7559\u8a00\u5185\u5bb9")},className:"p-6",children:[d&&(0,y.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,y.jsx)("p",{className:"text-sm text-red-600",children:d})}),(0,y.jsxs)("div",{className:"mb-4",children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7559\u8a00\u7c7b\u578b"}),(0,y.jsx)("select",{value:r.type,onChange:e=>n((0,l.A)((0,l.A)({},r),{},{type:e.target.value})),className:"input-field",required:!0,children:["\u5efa\u8bae","\u53cd\u9988","\u95ee\u9898","\u5176\u4ed6"].map(e=>(0,y.jsx)("option",{value:e,children:e},e))})]}),(0,y.jsxs)("div",{className:"mb-4",children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7559\u8a00\u5185\u5bb9 *"}),(0,y.jsx)("textarea",{value:r.content,onChange:e=>n((0,l.A)((0,l.A)({},r),{},{content:e.target.value})),placeholder:"\u8bf7\u8be6\u7ec6\u63cf\u8ff0\u4f60\u7684\u60f3\u6cd5\u3001\u5efa\u8bae\u6216\u95ee\u9898...",rows:6,className:"input-field resize-none",required:!0}),(0,y.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[r.content.length,"/1000 \u5b57\u7b26"]})]}),(0,y.jsxs)("div",{className:"mb-4",children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6807\u7b7e\uff08\u53ef\u9009\uff09"}),(0,y.jsx)("input",{type:"text",value:r.tags,onChange:e=>n((0,l.A)((0,l.A)({},r),{},{tags:e.target.value})),placeholder:"\u7528\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6807\u7b7e\uff0c\u5982\uff1a\u754c\u9762\u4f18\u5316,\u529f\u80fd\u5efa\u8bae",className:"input-field"})]}),(0,y.jsxs)("div",{className:"mb-4",children:[(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("input",{type:"checkbox",id:"anonymous",checked:r.isAnonymous,onChange:e=>n((0,l.A)((0,l.A)({},r),{},{isAnonymous:e.target.checked})),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,y.jsx)("label",{htmlFor:"anonymous",className:"ml-2 block text-sm text-gray-700",children:"\u533f\u540d\u7559\u8a00"})]}),(0,y.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u533f\u540d\u7559\u8a00\u5c06\u4e0d\u663e\u793a\u4f60\u7684\u8eab\u4efd\u4fe1\u606f"})]}),!r.isAnonymous&&(0,y.jsxs)("div",{className:"mb-6",children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8054\u7cfb\u65b9\u5f0f\uff08\u53ef\u9009\uff09"}),(0,y.jsx)("input",{type:"text",value:r.contactInfo,onChange:e=>n((0,l.A)((0,l.A)({},r),{},{contactInfo:e.target.value})),placeholder:"\u90ae\u7bb1\u3001\u5fae\u4fe1\u53f7\u7b49\uff0c\u65b9\u4fbf\u6211\u4eec\u8054\u7cfb\u4f60",className:"input-field"}),(0,y.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u4ec5\u7ba1\u7406\u5458\u53ef\u89c1\uff0c\u7528\u4e8e\u5fc5\u8981\u65f6\u7684\u6c9f\u901a"})]}),(0,y.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,y.jsx)("button",{type:"button",onClick:m,disabled:i,className:"btn-secondary",children:"\u53d6\u6d88"}),(0,y.jsx)("button",{type:"submit",disabled:i||!r.content.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"\u63d0\u4ea4\u4e2d..."]}):"\u63d0\u4ea4\u7559\u8a00"})]})]})]})}):null},f=()=>{const[e,t]=(0,a.useState)([]),[s,m]=(0,a.useState)(!0),[x,u]=(0,a.useState)(1),[g,b]=(0,a.useState)(1),[f,w]=(0,a.useState)(!1),[v,N]=(0,a.useState)({type:"",search:""}),[A,k]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{C()},[x,v]);const C=async()=>{try{m(!0);const s=await p.getPublicMessages({page:x,limit:10,type:v.type,search:v.search});var e;if(s.success)t(s.data),b((null===(e=s.pagination)||void 0===e?void 0:e.pages)||1)}catch(s){console.error("\u83b7\u53d6\u7559\u8a00\u5931\u8d25:",s)}finally{m(!1)}},M=e=>{const t={"\u5efa\u8bae":"bg-blue-100 text-blue-800","\u53cd\u9988":"bg-green-100 text-green-800","\u95ee\u9898":"bg-yellow-100 text-yellow-800","\u5176\u4ed6":"bg-gray-100 text-gray-800"};return t[e]||t["\u5176\u4ed6"]},E=e=>{switch(e){case"\u5f85\u5904\u7406":return(0,y.jsx)(r.A,{className:"h-4 w-4 text-yellow-500"});case"\u5904\u7406\u4e2d":return(0,y.jsx)(n.A,{className:"h-4 w-4 text-orange-500"});case"\u5df2\u56de\u590d":return(0,y.jsx)(i.A,{className:"h-4 w-4 text-green-500"});default:return(0,y.jsx)(r.A,{className:"h-4 w-4 text-gray-500"})}},I=e=>{const t=new Date(e),s=new Date,a=Math.abs(s.getTime()-t.getTime()),l=Math.ceil(a/864e5);return 1===l?"\u4eca\u5929":2===l?"\u6628\u5929":l<=7?"".concat(l,"\u5929\u524d"):t.toLocaleDateString()};return s?(0,y.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):(0,y.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,y.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,y.jsx)(c.A,{className:"h-8 w-8 mr-3 text-primary-600"}),"\u7559\u8a00\u5efa\u8bae\u7bb1"]}),(0,y.jsx)("p",{className:"text-gray-600 mt-1",children:"\u5206\u4eab\u4f60\u7684\u60f3\u6cd5\uff0c\u8ba9\u6211\u4eec\u4e00\u8d77\u6539\u8fdb"})]}),(0,y.jsxs)("button",{onClick:()=>w(!0),className:"btn-primary flex items-center space-x-2",children:[(0,y.jsx)(d.A,{className:"h-5 w-5"}),(0,y.jsx)("span",{children:"\u5199\u7559\u8a00"})]})]}),(0,y.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:(0,y.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,y.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,y.jsx)("input",{type:"text",placeholder:"\u641c\u7d22\u7559\u8a00\u5185\u5bb9...",value:v.search,onChange:e=>N((0,l.A)((0,l.A)({},v),{},{search:e.target.value})),className:"input-field"})}),(0,y.jsxs)("select",{value:v.type,onChange:e=>N((0,l.A)((0,l.A)({},v),{},{type:e.target.value})),className:"input-field w-auto min-w-[120px]",children:[(0,y.jsx)("option",{value:"",children:"\u6240\u6709\u7c7b\u578b"}),["\u5efa\u8bae","\u53cd\u9988","\u95ee\u9898","\u5176\u4ed6"].map(e=>(0,y.jsx)("option",{value:e,children:e},e))]})]})}),0===e.length?(0,y.jsxs)("div",{className:"text-center py-12",children:[(0,y.jsx)(c.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,y.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"\u6682\u65e0\u7559\u8a00"}),(0,y.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"\u6210\u4e3a\u7b2c\u4e00\u4e2a\u7559\u8a00\u7684\u4eba\u5427\uff01"}),(0,y.jsx)("div",{className:"mt-6",children:(0,y.jsxs)("button",{onClick:()=>w(!0),className:"btn-primary",children:[(0,y.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"\u5199\u7559\u8a00"]})})]}):(0,y.jsx)("div",{className:"space-y-4",children:e.map(s=>(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow duration-200",children:[(0,y.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,y.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(M(s.type)),children:s.type}),(0,y.jsxs)("div",{className:"flex items-center space-x-1",children:[E(s.status),(0,y.jsx)("span",{className:"text-sm text-gray-500",children:s.status})]})]}),(0,y.jsx)("span",{className:"text-sm text-gray-500",children:I(s.createdAt)})]}),(0,y.jsx)("div",{className:"mb-4",children:(0,y.jsx)("p",{className:"text-gray-800 leading-relaxed whitespace-pre-wrap",children:s.content})}),s.tags.length>0&&(0,y.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:s.tags.map((e,t)=>(0,y.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs",children:["#",e]},t))}),s.reply&&(0,y.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 mb-4",children:[(0,y.jsxs)("div",{className:"flex items-center mb-2",children:[(0,y.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"\u7ba1\u7406\u5458\u56de\u590d"}),(0,y.jsx)("span",{className:"text-xs text-blue-600 ml-2",children:I(s.reply.repliedAt)})]}),(0,y.jsx)("p",{className:"text-blue-800 text-sm leading-relaxed",children:s.reply.content})]}),(0,y.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,y.jsx)("div",{className:"flex items-center space-x-4",children:(0,y.jsxs)("button",{onClick:()=>(async s=>{if(!A.has(s))try{const a=await p.likeMessage(s);a.success&&(t(e.map(e=>e._id===s?(0,l.A)((0,l.A)({},e),{},{likes:a.data.likes}):e)),k(e=>new Set([...Array.from(e),s])))}catch(a){console.error("\u70b9\u8d5e\u5931\u8d25:",a)}})(s._id),disabled:A.has(s._id),className:"flex items-center space-x-1 text-sm transition-colors ".concat(A.has(s._id)?"text-red-600 cursor-not-allowed":"text-gray-500 hover:text-red-600"),children:[A.has(s._id)?(0,y.jsx)(h,{className:"h-4 w-4"}):(0,y.jsx)(o.A,{className:"h-4 w-4"}),(0,y.jsx)("span",{children:s.likes})]})}),(0,y.jsx)("div",{className:"text-xs text-gray-400",children:s.isAnonymous?"\u533f\u540d\u7528\u6237":"\u5b9e\u540d\u7528\u6237"})]})]},s._id))}),g>1&&(0,y.jsxs)("div",{className:"flex justify-center space-x-2 mt-8",children:[(0,y.jsx)("button",{onClick:()=>u(Math.max(1,x-1)),disabled:1===x,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0a\u4e00\u9875"}),(0,y.jsxs)("span",{className:"px-3 py-2 text-sm font-medium text-gray-700",children:[x," / ",g]}),(0,y.jsx)("button",{onClick:()=>u(Math.min(g,x+1)),disabled:x===g,className:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\u4e0b\u4e00\u9875"})]}),(0,y.jsx)(j,{isOpen:f,onClose:()=>{w(!1),C()}})]})},w=()=>(0,y.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,y.jsx)(f,{})})},36923:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80045),l=s(9950);const r=["title","titleId"];function n(e,t){let{title:s,titleId:n}=e,i=(0,a.A)(e,r);return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),s?l.createElement("title",{id:n},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const i=l.forwardRef(n)},57491:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80045),l=s(9950);const r=["title","titleId"];function n(e,t){let{title:s,titleId:n}=e,i=(0,a.A)(e,r);return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),s?l.createElement("title",{id:n},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const i=l.forwardRef(n)},59961:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80045),l=s(9950);const r=["title","titleId"];function n(e,t){let{title:s,titleId:n}=e,i=(0,a.A)(e,r);return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),s?l.createElement("title",{id:n},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"}))}const i=l.forwardRef(n)},75516:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(80045),l=s(9950);const r=["title","titleId"];function n(e,t){let{title:s,titleId:n}=e,i=(0,a.A)(e,r);return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),s?l.createElement("title",{id:n},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const i=l.forwardRef(n)}}]);