"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[158],{11818:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(80045),a=s(9950);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,o=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const o=a.forwardRef(l)},48505:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(80045),a=s(9950);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,o=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const o=a.forwardRef(l)},85211:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(80045),a=s(9950);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,o=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},o),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-7.5-13.5v13.5"}))}const o=a.forwardRef(l)},95158:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var r=s(9950),a=s(11818),n=s(48505),l=s(85211),o=s(80045);const i=["title","titleId"];function c(e,t){let{title:s,titleId:a}=e,n=(0,o.A)(e,i);return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const d=r.forwardRef(c);var u=s(36923),h=s(82932);const x=new class{constructor(){this.apiClient={get:(e,t)=>h.A.get("/pomodoro".concat(e),t),post:(e,t,s)=>h.A.post("/pomodoro".concat(e),t,s),put:(e,t,s)=>h.A.put("/pomodoro".concat(e),t,s),delete:(e,t)=>h.A.delete("/pomodoro".concat(e),t)}}async getSessions(e){try{const t=await this.apiClient.get("/sessions",{params:e});return t.data||t}catch(r){var t,s;throw new Error((null===(t=r.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"\u83b7\u53d6\u4f1a\u8bdd\u8bb0\u5f55\u5931\u8d25")}}async startSession(e){try{const t=await this.apiClient.post("/sessions",e);return t.data||t}catch(s){var t;throw new Error((null===(t=s.data)||void 0===t?void 0:t.message)||"\u5f00\u59cb\u4f1a\u8bdd\u5931\u8d25")}}async completeSession(e,t){try{const s=await this.apiClient.put("/sessions/".concat(e,"/complete"),t);return s.data||s}catch(r){var s;throw new Error((null===(s=r.data)||void 0===s?void 0:s.message)||"\u5b8c\u6210\u4f1a\u8bdd\u5931\u8d25")}}async cancelSession(e,t){try{const s=await this.apiClient.put("/sessions/".concat(e,"/cancel"),{reason:t});return s.data||s}catch(r){var s;throw new Error((null===(s=r.data)||void 0===s?void 0:s.message)||"\u53d6\u6d88\u4f1a\u8bdd\u5931\u8d25")}}async updateSession(e,t){try{const s=await this.apiClient.put("/sessions/".concat(e),t);return s.data||s}catch(r){var s;throw new Error((null===(s=r.data)||void 0===s?void 0:s.message)||"\u66f4\u65b0\u4f1a\u8bdd\u5931\u8d25")}}async deleteSession(e){try{const t=await this.apiClient.delete("/sessions/".concat(e));return t.data||t}catch(s){var t;throw new Error((null===(t=s.data)||void 0===t?void 0:t.message)||"\u5220\u9664\u4f1a\u8bdd\u5931\u8d25")}}async getPomodoroStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"week";try{const t=await this.apiClient.get("/stats",{params:{period:e}});return t.data||t}catch(s){var t;throw new Error((null===(t=s.data)||void 0===t?void 0:t.message)||"\u83b7\u53d6\u7edf\u8ba1\u4fe1\u606f\u5931\u8d25")}}};var m=s(44414);const g=e=>{let{className:t=""}=e;const[s,o]=(0,r.useState)(null),[i,c]=(0,r.useState)("work"),[h,g]=(0,r.useState)("idle"),[v,p]=(0,r.useState)(1500),[w,b]=(0,r.useState)(""),[f,j]=(0,r.useState)("\u5de5\u4f5c"),[y,N]=(0,r.useState)(0),[k,A]=(0,r.useState)(!1),[S,C]=(0,r.useState)(null),E=(0,r.useRef)(null),B=(0,r.useRef)(null),I=(0,r.useRef)(0),L={work:{duration:1500,label:"\u5de5\u4f5c\u65f6\u95f4",color:"bg-red-500"},shortBreak:{duration:300,label:"\u77ed\u4f11\u606f",color:"bg-green-500"},longBreak:{duration:900,label:"\u957f\u4f11\u606f",color:"bg-blue-500"}};(0,r.useEffect)(()=>{p(L[i].duration)},[i]),(0,r.useEffect)(()=>("running"===h?E.current=setInterval(()=>{p(e=>e<=1?(F(),0):e-1)},1e3):E.current&&(clearInterval(E.current),E.current=null),()=>{E.current&&clearInterval(E.current)}),[h]);const M=async()=>{try{if("idle"===h){const e={type:"work"===i?"\u5de5\u4f5c":"shortBreak"===i?"\u77ed\u4f11\u606f":"\u957f\u4f11\u606f",duration:L[i].duration,task:w||void 0,category:f},t=await x.startSession(e);o(t.data),B.current=new Date,I.current=0}g("running")}catch(e){console.error("\u542f\u52a8\u756a\u8304\u949f\u5931\u8d25:",e)}},F=async()=>{try{if(s){L[i].duration;if(await x.completeSession(s._id,{notes:"".concat(L[i].label,"\u5b8c\u6210")}),"work"===i){N(e=>e+1);c(y>0&&(y+1)%4===0?"longBreak":"shortBreak")}else c("work")}g("idle"),o(null),B.current=null,I.current=0,O(),"Notification"in window&&"granted"===Notification.permission&&new Notification("".concat(L[i].label,"\u5b8c\u6210\uff01"),{body:"work"===i?"\u4f11\u606f\u4e00\u4e0b\u5427\uff01":"\u5f00\u59cb\u5de5\u4f5c\u5427\uff01",icon:"/favicon.ico"})}catch(e){console.error("\u5b8c\u6210\u756a\u8304\u949f\u5931\u8d25:",e)}},O=()=>{new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT").play().catch(()=>{})};return(0,r.useEffect)(()=>{"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission()},[]),(0,m.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 ".concat(t),children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,m.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"\u756a\u8304\u949f\u8ba1\u65f6\u5668"}),(0,m.jsxs)("button",{onClick:async()=>{try{const e=(await x.getSessions({limit:100})).data.sessions,t=e.length,s=e.filter(e=>e.isCompleted).length,r=e.reduce((e,t)=>e+(t.actualDuration||0),0);C({totalSessions:t,completedSessions:s,totalFocusTime:r}),A(!0)}catch(e){console.error("\u83b7\u53d6\u7edf\u8ba1\u6570\u636e\u5931\u8d25:",e)}},className:"flex items-center px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,m.jsx)(a.A,{className:"h-4 w-4 mr-1"}),"\u7edf\u8ba1"]})]}),(0,m.jsx)("div",{className:"flex justify-center mb-6",children:(0,m.jsx)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:Object.entries(L).map(e=>{let[t,s]=e;return(0,m.jsx)("button",{onClick:()=>{"idle"===h&&c(t)},disabled:"idle"!==h,className:"px-4 py-2 rounded-md transition-colors ".concat(i===t?"bg-white text-gray-800 shadow-sm":"text-gray-600 hover:text-gray-800"," ").concat("idle"!==h?"opacity-50 cursor-not-allowed":""),children:s.label},t)})})}),(0,m.jsx)("div",{className:"flex justify-center mb-8",children:(0,m.jsxs)("div",{className:"relative w-48 h-48",children:[(0,m.jsxs)("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[(0,m.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:"#e5e7eb",strokeWidth:"8",fill:"none"}),(0,m.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:L[i].color.replace("bg-","#"),strokeWidth:"8",fill:"none",strokeDasharray:"".concat(2*Math.PI*45),strokeDashoffset:"".concat(2*Math.PI*45*(1-(()=>{const e=L[i].duration;return(e-v)/e*100})()/100)),className:"transition-all duration-1000 ease-linear"})]}),(0,m.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,m.jsx)("div",{className:"text-3xl font-bold text-gray-800",children:(e=>{const t=Math.floor(e/60),s=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(s.toString().padStart(2,"0"))})(v)}),(0,m.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:L[i].label})]})]})}),"idle"===h&&"work"===i&&(0,m.jsx)("div",{className:"mb-6",children:(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,m.jsx)("input",{type:"text",placeholder:"\u5f53\u524d\u4efb\u52a1\uff08\u53ef\u9009\uff09",value:w,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md"}),(0,m.jsxs)("select",{value:f,onChange:e=>j(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md",children:[(0,m.jsx)("option",{value:"\u5de5\u4f5c",children:"\u5de5\u4f5c"}),(0,m.jsx)("option",{value:"\u5b66\u4e60",children:"\u5b66\u4e60"}),(0,m.jsx)("option",{value:"\u521b\u4f5c",children:"\u521b\u4f5c"}),(0,m.jsx)("option",{value:"\u5176\u4ed6",children:"\u5176\u4ed6"})]})]})}),(0,m.jsx)("div",{className:"flex justify-center space-x-4 mb-6",children:"idle"===h?(0,m.jsxs)("button",{onClick:M,className:"flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,m.jsx)(n.A,{className:"h-5 w-5 mr-2"}),"\u5f00\u59cb"]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("button",{onClick:"running"===h?()=>{g("paused"),B.current&&(I.current+=Date.now()-B.current.getTime())}:M,className:"flex items-center px-6 py-3 rounded-lg transition-colors ".concat("running"===h?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-green-600 hover:bg-green-700 text-white"),children:"running"===h?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l.A,{className:"h-5 w-5 mr-2"}),"\u6682\u505c"]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(n.A,{className:"h-5 w-5 mr-2"}),"\u7ee7\u7eed"]})}),(0,m.jsxs)("button",{onClick:async()=>{try{s&&await x.cancelSession(s._id),g("idle"),p(L[i].duration),o(null),B.current=null,I.current=0}catch(e){console.error("\u505c\u6b62\u756a\u8304\u949f\u5931\u8d25:",e)}},className:"flex items-center px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,m.jsx)(d,{className:"h-5 w-5 mr-2"}),"\u505c\u6b62"]})]})}),(0,m.jsx)("div",{className:"text-center",children:(0,m.jsxs)("div",{className:"inline-flex items-center px-4 py-2 bg-blue-50 rounded-lg",children:[(0,m.jsx)(u.A,{className:"h-5 w-5 text-blue-600 mr-2"}),(0,m.jsxs)("span",{className:"text-blue-800",children:["\u4eca\u65e5\u5b8c\u6210: ",y," \u4e2a\u756a\u8304\u949f"]})]})}),k&&S&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,m.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,m.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"\u756a\u8304\u949f\u7edf\u8ba1"}),(0,m.jsx)("button",{onClick:()=>A(!1),className:"text-gray-400 hover:text-gray-600",children:"\xd7"})]}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,m.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-green-600",children:S.totalSessions||0}),(0,m.jsx)("div",{className:"text-sm text-green-700",children:"\u603b\u4f1a\u8bdd\u6570"})]}),(0,m.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[(0,m.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:S.completedSessions||0}),(0,m.jsx)("div",{className:"text-sm text-blue-700",children:"\u5df2\u5b8c\u6210"})]})]}),(0,m.jsxs)("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:[Math.round((S.totalFocusTime||0)/60)," \u5206\u949f"]}),(0,m.jsx)("div",{className:"text-sm text-purple-700",children:"\u603b\u4e13\u6ce8\u65f6\u95f4"})]}),(0,m.jsxs)("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[(0,m.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round((S.completedSessions||0)/(S.totalSessions||1)*100),"%"]}),(0,m.jsx)("div",{className:"text-sm text-orange-700",children:"\u5b8c\u6210\u7387"})]})]})]})})]})}}}]);