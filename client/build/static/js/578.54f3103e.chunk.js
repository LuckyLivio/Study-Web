"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[578],{26578:(e,t,r)=>{r.r(t),r.d(t,{default:()=>xt});var s=r(9950),n=r(43711),a=r(27321),l=r(20900),i=r(43302),o=r(89379),c=r(80045),d=r(38796),x=r(82024),h=r(81415),u=r(29742),m=r(24514),A=r(32284),j=r(6503),p=r(51593),g=r(65517),y=r(58781),v=r(62101),f=r(29566),b=r(47152),C=r(79457),w=r(82715);const S=new class{async getCourses(e){const t=await w.A.get("/schedule/courses",{params:e});return t.data||t}async getCourseById(e){const t=await w.A.get("/schedule/courses/".concat(e));return t.data||t}async createCourse(e){const t=await w.A.post("/schedule/courses",e);return t.data||t}async updateCourse(e,t){const r=await w.A.put("/schedule/courses/".concat(e),t);return r.data||r}async deleteCourse(e){const t=await w.A.delete("/schedule/courses/".concat(e));return t.data||t}async updateCourseRating(e,t,r){const s=await w.A.put("/schedule/courses/".concat(e,"/rating"),{rating:t,review:r});return s.data||s}async getCourseTags(){const e=await w.A.get("/schedule/courses/tags");return e.data||e}async getDepartments(){const e=await w.A.get("/schedule/courses/departments");return e.data||e}async getSchedule(e){const t=await w.A.get("/schedule/schedule",{params:e});return t.data||t}async addScheduleSlot(e){const t=await w.A.post("/schedule/schedule/slots",e);return t.data||t}async updateScheduleSlot(e,t){const r=await w.A.put("/schedule/schedule/slots/".concat(e),t);return r.data||r}async deleteScheduleSlot(e){const t=await w.A.delete("/schedule/schedule/slots/".concat(e));return t.data||t}async batchAddScheduleSlots(e){const t=await w.A.post("/schedule/schedule/slots/batch",{slots:e});return t.data||t}async getScheduleTemplates(){const e=await w.A.get("/schedule/templates");return e.data||e}async createScheduleTemplate(e){const t=await w.A.post("/schedule/templates",e);return t.data||t}async updateScheduleTemplate(e,t){const r=await w.A.put("/schedule/templates/".concat(e),t);return r.data||r}async deleteScheduleTemplate(e){const t=await w.A.delete("/schedule/templates/".concat(e));return t.data||t}async setDefaultTemplate(e){const t=await w.A.put("/schedule/templates/".concat(e,"/default"));return t.data||t}async uploadScheduleFile(e,t){const r=new FormData;r.append("scheduleFile",e),t&&r.append("notes",t);const s=await w.A.post("/schedule/upload",r,{headers:{"Content-Type":"multipart/form-data"}});return s.data||s}async getUploadedFiles(){const e=await w.A.get("/schedule/files");return e.data||e}async deleteUploadedFile(e){const t=await w.A.delete("/schedule/files/".concat(e));return t.data||t}async createSharedSchedule(e){const t=await w.A.post("/schedule/shared-schedules",e);return t.data||t}async getPublicSharedSchedules(e){const t=await w.A.get("/schedule/shared-schedules/public",{params:e});return t.data||t}async getSharedScheduleByCode(e){const t=await w.A.get("/schedule/shared-schedules/code/".concat(e));return t.data||t}async compareSchedules(e){const t=await w.A.post("/schedule/shared-schedules/compare",{scheduleIds:e});return t.data||t}getDayName(e){return["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"][e]||"\u672a\u77e5"}formatTime(e){return e.substring(0,5)}getTimeSlotDisplay(e,t){return"".concat(this.formatTime(e)," - ").concat(this.formatTime(t))}getWeeksDisplay(e){if(0===e.length)return"\u65e0";if(1===e.length)return"\u7b2c".concat(e[0],"\u5468");const t=[...e].sort((e,t)=>e-t),r=[];let s=t[0],n=t[0];for(let a=1;a<t.length;a++)t[a]===n+1?n=t[a]:(r.push(s===n?"\u7b2c".concat(s,"\u5468"):"\u7b2c".concat(s,"-").concat(n,"\u5468")),s=n=t[a]);return r.push(s===n?"\u7b2c".concat(s,"\u5468"):"\u7b2c".concat(s,"-").concat(n,"\u5468")),r.join(", ")}getDefaultColors(){return["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#85C1E9","#D7BDE2"]}getRandomColor(){const e=this.getDefaultColors();return e[Math.floor(Math.random()*e.length)]}};var k=r(91651),T=r(5352),D=r(87209),W=r(24556),I=r(56141),B=r(94837),z=r(66615),H=r(55547),E=r(52036),R=r(71500),F=r(91521),P=r(17153),M=r(26897),_=r(80218),O=r(6732),L=r(65250),G=r(47371),N=r(91724),U=r(50861),K=r(50670),q=r(13285),Z=r(71672),J=r(72619),Y=r(44414);const Q=e=>{let{courses:t,onCourseEdit:r,onCourseDelete:n,onRefresh:i,loading:o}=e;const[c,d]=(0,s.useState)(t),[x,h]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[A,p]=(0,s.useState)([]),[g,y]=(0,s.useState)([]),[v,f]=(0,s.useState)(null),[C,w]=(0,s.useState)(null),[Q,V]=(0,s.useState)(!1),[X,$]=(0,s.useState)(null);(0,s.useEffect)(()=>{d(t),ee(),te()},[t]),(0,s.useEffect)(()=>{re()},[x,u,t]);const ee=async()=>{try{const e=await S.getDepartments();e.success&&e.data&&p(e.data)}catch(e){console.error("\u52a0\u8f7d\u9662\u7cfb\u5217\u8868\u5931\u8d25:",e)}},te=async()=>{try{const e=await S.getCourseTags();e.success&&e.data&&y(e.data)}catch(e){console.error("\u52a0\u8f7d\u6807\u7b7e\u5217\u8868\u5931\u8d25:",e)}},re=()=>{let e=t;x&&(e=e.filter(e=>e.name.toLowerCase().includes(x.toLowerCase())||e.teacher.toLowerCase().includes(x.toLowerCase())||e.courseCode.toLowerCase().includes(x.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(x.toLowerCase())))),u&&(e=e.filter(e=>e.department===u)),d(e)},se=()=>{f(null),w(null)},ne=()=>{V(!1),$(null)};return o&&0===t.length?(0,Y.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:(0,Y.jsx)(j.A,{})}):(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(a.A,{sx:{mb:3},children:(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 2fr 1fr"},gap:2,alignItems:"center"},children:[(0,Y.jsx)(k.A,{fullWidth:!0,placeholder:"\u641c\u7d22\u8bfe\u7a0b\u540d\u79f0\u3001\u6559\u5e08\u3001\u8bfe\u7a0b\u4ee3\u7801\u6216\u6807\u7b7e...",value:x,onChange:e=>h(e.target.value),InputProps:{startAdornment:(0,Y.jsx)(T.A,{position:"start",children:(0,Y.jsx)(N.A,{})})}}),(0,Y.jsxs)(D.A,{fullWidth:!0,children:[(0,Y.jsx)(W.A,{children:"\u9662\u7cfb\u7b5b\u9009"}),(0,Y.jsxs)(I.A,{value:u,label:"\u9662\u7cfb\u7b5b\u9009",onChange:e=>m(e.target.value),children:[(0,Y.jsx)(B.A,{value:"",children:"\u5168\u90e8\u9662\u7cfb"}),A.map(e=>(0,Y.jsx)(B.A,{value:e,children:e},e))]})]}),(0,Y.jsx)(z.A,{fullWidth:!0,variant:"outlined",startIcon:(0,Y.jsx)(U.A,{}),onClick:i,disabled:o,children:"\u5237\u65b0"})]})}),(0,Y.jsx)(a.A,{sx:{mb:3},children:(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\u5171\u627e\u5230 ",c.length," \u95e8\u8bfe\u7a0b"]})}),0===c.length?(0,Y.jsxs)(a.A,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:300,textAlign:"center",children:[(0,Y.jsx)(b.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,Y.jsx)(l.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:0===t.length?"\u6682\u65e0\u8bfe\u7a0b":"\u672a\u627e\u5230\u5339\u914d\u7684\u8bfe\u7a0b"}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:0===t.length?"\u70b9\u51fb\u53f3\u4e0b\u89d2\u7684 + \u6309\u94ae\u6dfb\u52a0\u7b2c\u4e00\u95e8\u8bfe\u7a0b":"\u5c1d\u8bd5\u8c03\u6574\u641c\u7d22\u6761\u4ef6\u6216\u7b5b\u9009\u5668"})]}):(0,Y.jsx)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:2},children:c.map(e=>{return(0,Y.jsxs)(H.A,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative","&:hover":{boxShadow:4}},children:[(0,Y.jsx)(a.A,{sx:{height:4,backgroundColor:e.color}}),(0,Y.jsxs)(E.A,{sx:{flexGrow:1,pb:1},children:[(0,Y.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[(0,Y.jsxs)(a.A,{flex:1,children:[(0,Y.jsx)(l.A,{variant:"h6",component:"h3",gutterBottom:!0,children:e.name}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.courseCode})]}),(0,Y.jsx)(R.A,{size:"small",onClick:t=>((e,t)=>{f(e.currentTarget),w(t)})(t,e),children:(0,Y.jsx)(K.A,{})})]}),(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:1,children:[(0,Y.jsx)(q.A,{sx:{fontSize:16,mr:1,color:"text.secondary"}}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.teacher})]}),(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:2,children:[(0,Y.jsx)(b.A,{sx:{fontSize:16,mr:1,color:"text.secondary"}}),(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:[e.department," \u2022 ",(t=e.credits,"".concat(t,"\u5b66\u5206"))]})]}),e.description&&(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:e.description}),e.tags.length>0&&(0,Y.jsxs)(a.A,{mb:2,children:[e.tags.slice(0,3).map((e,t)=>(0,Y.jsx)(F.A,{label:e,size:"small",sx:{mr:.5,mb:.5}},t)),e.tags.length>3&&(0,Y.jsx)(F.A,{label:"+".concat(e.tags.length-3),size:"small",variant:"outlined",sx:{mr:.5,mb:.5}})]}),e.rating&&(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mt:"auto",children:[(0,Y.jsx)(P.A,{value:e.rating,readOnly:!0,size:"small",sx:{mr:1}}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:e.rating.toFixed(1)})]})]})]},e._id);var t})}),(0,Y.jsxs)(M.A,{anchorEl:v,open:Boolean(v),onClose:se,children:[(0,Y.jsxs)(B.A,{onClick:()=>{C&&r(C),se()},children:[(0,Y.jsx)(Z.A,{sx:{mr:1}}),"\u7f16\u8f91\u8bfe\u7a0b"]}),(0,Y.jsxs)(B.A,{onClick:()=>{C&&($(C),V(!0)),se()},sx:{color:"error.main"},children:[(0,Y.jsx)(J.A,{sx:{mr:1}}),"\u5220\u9664\u8bfe\u7a0b"]})]}),(0,Y.jsxs)(_.A,{open:Q,onClose:ne,maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(O.A,{children:"\u786e\u8ba4\u5220\u9664\u8bfe\u7a0b"}),(0,Y.jsxs)(L.A,{children:[(0,Y.jsxs)(l.A,{children:['\u786e\u5b9a\u8981\u5220\u9664\u8bfe\u7a0b "',null===X||void 0===X?void 0:X.name,'" \u5417\uff1f']}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"\u5220\u9664\u540e\uff0c\u76f8\u5173\u7684\u8bfe\u8868\u5b89\u6392\u4e5f\u5c06\u88ab\u79fb\u9664\uff0c\u6b64\u64cd\u4f5c\u4e0d\u53ef\u64a4\u9500\u3002"})]}),(0,Y.jsxs)(G.A,{children:[(0,Y.jsx)(z.A,{onClick:ne,children:"\u53d6\u6d88"}),(0,Y.jsx)(z.A,{onClick:()=>{X&&n(X._id),V(!1),$(null)},color:"error",variant:"contained",children:"\u5220\u9664"})]})]})]})};var V=r(41530),X=r(20795),$=r(89737);const ee=e=>{let{schedule:t,courses:r,currentSemester:n,currentWeek:i,onSemesterChange:o,onWeekChange:c,onSlotCreate:x,onSlotEdit:h,onSlotDelete:u,loading:m}=e;const[A,p]=(0,s.useState)(null),[y,v]=(0,s.useState)(null),f=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],b=Array.from({length:20},(e,t)=>t+1),C=()=>{p(null),v(null)},w=e=>e.weeks.includes(i),k=e=>{const t="string"===typeof e.course?(s=e.course,r.find(e=>e._id===s)||null):e.course;var s;if(!t)return null;const n=w(e);return(0,Y.jsx)(H.A,{sx:{height:"100%",minHeight:120,backgroundColor:t.color,color:"white",opacity:n?1:.5,cursor:"pointer",position:"relative","&:hover":{opacity:n?.9:.6,transform:"scale(1.02)"}},onClick:()=>h(e),children:(0,Y.jsxs)(E.A,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,Y.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[(0,Y.jsx)(l.A,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5},children:t.name}),(0,Y.jsx)(R.A,{size:"small",sx:{color:"white",p:.5},onClick:t=>{t.stopPropagation(),((e,t)=>{p(e.currentTarget),v(t)})(t,e)},children:(0,Y.jsx)(K.A,{fontSize:"small"})})]}),(0,Y.jsx)(l.A,{variant:"caption",display:"block",sx:{mb:.5},children:t.teacher}),e.location&&(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:.5,children:[(0,Y.jsx)(V.A,{sx:{fontSize:12,mr:.5}}),(0,Y.jsx)(l.A,{variant:"caption",children:e.location})]}),(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:.5,children:[(0,Y.jsx)(X.A,{sx:{fontSize:12,mr:.5}}),(0,Y.jsxs)(l.A,{variant:"caption",children:[S.formatTime(e.startTime)," - ",S.formatTime(e.endTime)]})]}),(0,Y.jsx)(l.A,{variant:"caption",display:"block",children:S.getWeeksDisplay(e.weeks)}),!n&&(0,Y.jsx)(F.A,{label:"\u975e\u5f53\u524d\u5468",size:"small",sx:{position:"absolute",top:4,right:4,backgroundColor:"rgba(255,255,255,0.2)",color:"white",fontSize:"0.6rem"}})]})})},T=(e,t)=>(0,Y.jsx)(H.A,{sx:{height:"100%",minHeight:120,border:"2px dashed",borderColor:"grey.300",backgroundColor:"grey.50",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{borderColor:"primary.main",backgroundColor:"primary.50"}},onClick:()=>x(e),children:(0,Y.jsxs)(a.A,{textAlign:"center",children:[(0,Y.jsx)(g.A,{sx:{fontSize:32,color:"grey.400",mb:1}}),(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",children:"\u6dfb\u52a0\u8bfe\u7a0b"})]})});return m?(0,Y.jsx)(a.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:(0,Y.jsx)(j.A,{})}):(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(d.A,{sx:{p:2,mb:3},children:(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr 2fr"},gap:2,alignItems:"center"},children:[(0,Y.jsxs)(D.A,{fullWidth:!0,children:[(0,Y.jsx)(W.A,{children:"\u5b66\u671f"}),(0,Y.jsx)(I.A,{value:n,label:"\u5b66\u671f",onChange:e=>o(e.target.value),children:["2024-1","2024-2","2023-1","2023-2"].map(e=>(0,Y.jsxs)(B.A,{value:e,children:[e.replace("-","\u5b66\u5e74\u7b2c"),"\u5b66\u671f"]},e))})]}),(0,Y.jsxs)(D.A,{fullWidth:!0,children:[(0,Y.jsx)(W.A,{children:"\u5468\u6b21"}),(0,Y.jsx)(I.A,{value:i,label:"\u5468\u6b21",onChange:e=>c(Number(e.target.value)),children:b.map(e=>(0,Y.jsxs)(B.A,{value:e,children:["\u7b2c",e,"\u5468"]},e))})]}),(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:[(0,Y.jsx)($.A,{sx:{mr:1,color:"text.secondary"}}),(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["\u5f53\u524d\u663e\u793a\uff1a",n.replace("-","\u5b66\u5e74\u7b2c"),"\u5b66\u671f \u7b2c",i,"\u5468"]})]})]})}),(0,Y.jsx)(d.A,{sx:{overflow:"hidden"},children:(0,Y.jsx)(a.A,{sx:{overflowX:"auto"},children:(0,Y.jsxs)(a.A,{sx:{minWidth:800},children:[(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",backgroundColor:"grey.100"},children:[(0,Y.jsx)(a.A,{sx:{p:2,textAlign:"center",borderRight:1,borderColor:"divider"},children:(0,Y.jsx)(l.A,{variant:"subtitle2",fontWeight:"bold",children:"\u65f6\u95f4\\\u661f\u671f"})}),[1,2,3,4,5,6,0].map(e=>(0,Y.jsx)(a.A,{sx:{p:2,textAlign:"center",borderRight:1,borderColor:"divider"},children:(0,Y.jsx)(l.A,{variant:"subtitle2",fontWeight:"bold",children:f[e]})},e))]}),[{period:1,startTime:"08:00",endTime:"09:40"},{period:2,startTime:"10:00",endTime:"11:40"},{period:3,startTime:"14:00",endTime:"15:40"},{period:4,startTime:"16:00",endTime:"17:40"},{period:5,startTime:"19:00",endTime:"20:40"}].map(e=>(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",borderBottom:1,borderColor:"divider"},children:[(0,Y.jsxs)(a.A,{sx:{p:2,textAlign:"center",borderRight:1,borderColor:"divider",backgroundColor:"grey.50",minHeight:140},children:[(0,Y.jsxs)(l.A,{variant:"body2",fontWeight:"bold",children:["\u7b2c",e.period,"\u8282"]}),(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",children:e.startTime}),(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",display:"block",children:e.endTime})]}),[1,2,3,4,5,6,0].map(r=>{const s=((e,r)=>(t[e]||[]).find(e=>{const t=e.startTime.substring(0,5),s=e.endTime.substring(0,5);return t===r.startTime&&s===r.endTime})||null)(r,e);return(0,Y.jsx)(a.A,{sx:{p:1,borderRight:1,borderColor:"divider",minHeight:140},children:s?k(s):T(r)},r)})]},e.period))]})})}),(0,Y.jsxs)(d.A,{sx:{p:2,mt:3},children:[(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u8bfe\u8868\u7edf\u8ba1"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:2},children:[(0,Y.jsxs)(a.A,{textAlign:"center",children:[(0,Y.jsx)(l.A,{variant:"h4",color:"primary",children:Object.values(t).flat().length}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u603b\u8bfe\u7a0b\u5b89\u6392"})]}),(0,Y.jsxs)(a.A,{textAlign:"center",children:[(0,Y.jsx)(l.A,{variant:"h4",color:"success.main",children:Object.values(t).flat().filter(e=>w(e)).length}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u672c\u5468\u8bfe\u7a0b"})]}),(0,Y.jsxs)(a.A,{textAlign:"center",children:[(0,Y.jsx)(l.A,{variant:"h4",color:"info.main",children:r.length}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u8bfe\u7a0b\u603b\u6570"})]}),(0,Y.jsx)(a.A,{textAlign:"center",children:(0,Y.jsx)(l.A,{variant:"h4",color:"warning.main",children:r.reduce((e,t)=>e+t.credits,0)})})]})]}),(0,Y.jsxs)(M.A,{anchorEl:A,open:Boolean(A),onClose:C,children:[(0,Y.jsxs)(B.A,{onClick:()=>{y&&h(y),C()},children:[(0,Y.jsx)(Z.A,{sx:{mr:1}}),"\u7f16\u8f91\u8bfe\u7a0b\u5b89\u6392"]}),(0,Y.jsxs)(B.A,{onClick:()=>{y&&y._id&&u(y._id),C()},sx:{color:"error.main"},children:[(0,Y.jsx)(J.A,{sx:{mr:1}}),"\u5220\u9664\u8bfe\u7a0b\u5b89\u6392"]})]})]})};var te=r(98506),re=r(46349),se=r(57315),ne=r(13052),ae=r(45982),le=r(39872),ie=r(55044);const oe=e=>{let{onUploadSuccess:t,onError:r}=e;const[n,i]=(0,s.useState)([]),[c,x]=(0,s.useState)(!1),[h,u]=(0,s.useState)(0),[m,j]=(0,s.useState)(!1),[p,g]=(0,s.useState)(null),[y,v]=(0,s.useState)(!1),[f,b]=(0,s.useState)(null),[C,w]=(0,s.useState)("");(0,s.useEffect)(()=>{T()},[]);const T=async()=>{try{const e=await S.getUploadedFiles();e.success&&e.data&&i(e.data)}catch(e){r("\u52a0\u8f7d\u6587\u4ef6\u5217\u8868\u5931\u8d25"),console.error("\u52a0\u8f7d\u6587\u4ef6\u5931\u8d25:",e)}},D=(0,s.useCallback)(async e=>{if(0===e.length)return;const s=e[0];if(["image/jpeg","image/png","image/gif","image/webp","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type))if(s.size>10485760)r("\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u9650\u5236\uff08\u6700\u592710MB\uff09");else try{x(!0),u(0);const e=setInterval(()=>{u(t=>t>=90?(clearInterval(e),90):t+10)},200),n=await S.uploadScheduleFile(s,C);clearInterval(e),u(100),n.success?(t(),T(),w(""),setTimeout(()=>{u(0)},1e3)):r("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25")}catch(n){r("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"),console.error("\u4e0a\u4f20\u5931\u8d25:",n)}finally{x(!1)}else r("\u4e0d\u652f\u6301\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u8bf7\u4e0a\u4f20\u56fe\u7247\u6216Excel\u6587\u4ef6")},[C,t,r]),{getRootProps:W,getInputProps:I,isDragActive:B}=(0,ie.VB)({onDrop:D,accept:{"image/*":[".jpeg",".jpg",".png",".gif",".webp"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"]},multiple:!1,disabled:c}),P=()=>{j(!1),g(null)},M=()=>{v(!1),b(null)},N=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},U=e=>"image"===e?"\u56fe\u7247":"Excel";return(0,Y.jsxs)(a.A,{children:[(0,Y.jsxs)(d.A,(0,o.A)((0,o.A)({},W()),{},{sx:{p:4,mb:3,border:"2px dashed",borderColor:B?"primary.main":"grey.300",backgroundColor:B?"primary.50":"grey.50",cursor:c?"not-allowed":"pointer",textAlign:"center",transition:"all 0.3s ease","&:hover":{borderColor:c?"grey.300":"primary.main",backgroundColor:c?"grey.50":"primary.50"}},children:[(0,Y.jsx)("input",(0,o.A)({},I())),(0,Y.jsx)(ae.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:B?"\u653e\u5f00\u6587\u4ef6\u4ee5\u4e0a\u4f20":"\u62d6\u62fd\u6587\u4ef6\u5230\u6b64\u5904\u6216\u70b9\u51fb\u9009\u62e9\u6587\u4ef6"}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"\u652f\u6301\u56fe\u7247\u683c\u5f0f\uff1aJPEG, PNG, GIF, WebP"}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u652f\u6301\u8868\u683c\u683c\u5f0f\uff1aExcel (.xls, .xlsx)"}),(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:"\u6700\u5927\u6587\u4ef6\u5927\u5c0f\uff1a10MB"}),c&&(0,Y.jsxs)(a.A,{sx:{mt:2,maxWidth:300,mx:"auto"},children:[(0,Y.jsx)(te.A,{variant:"determinate",value:h}),(0,Y.jsxs)(l.A,{variant:"caption",color:"text.secondary",sx:{mt:1},children:["\u4e0a\u4f20\u8fdb\u5ea6\uff1a",h,"%"]})]})]})),(0,Y.jsx)(d.A,{sx:{p:2,mb:3},children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u6587\u4ef6\u5907\u6ce8\uff08\u53ef\u9009\uff09",value:C,onChange:e=>w(e.target.value),placeholder:"\u4e3a\u4e0a\u4f20\u7684\u6587\u4ef6\u6dfb\u52a0\u5907\u6ce8\u4fe1\u606f...",disabled:c})}),(0,Y.jsxs)(d.A,{sx:{p:2},children:[(0,Y.jsxs)(l.A,{variant:"h6",gutterBottom:!0,children:["\u5df2\u4e0a\u4f20\u7684\u6587\u4ef6 (",n.length,")"]}),0===n.length?(0,Y.jsxs)(a.A,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200,textAlign:"center",children:[(0,Y.jsx)(ae.A,{sx:{fontSize:64,color:"text.secondary",mb:2}}),(0,Y.jsx)(l.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"\u6682\u65e0\u4e0a\u4f20\u6587\u4ef6"}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u4e0a\u4f20\u60a8\u7684\u8bfe\u8868\u56fe\u7247\u6216Excel\u6587\u4ef6\u5f00\u59cb\u7ba1\u7406"})]}):(0,Y.jsx)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:2},children:n.map(e=>{return(0,Y.jsxs)(H.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,Y.jsxs)(E.A,{sx:{flexGrow:1},children:[(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:1,children:[(t=e.fileType,"image"===t?(0,Y.jsx)(se.A,{}):(0,Y.jsx)(ne.A,{})),(0,Y.jsx)(F.A,{label:U(e.fileType),size:"small",color:"image"===e.fileType?"primary":"secondary",sx:{ml:1}})]}),(0,Y.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,noWrap:!0,children:e.originalName}),(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["\u5927\u5c0f\uff1a",N(e.fileSize)]}),(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["\u4e0a\u4f20\u65f6\u95f4\uff1a",new Date(e.uploadDate||"").toLocaleString()]}),e.notes&&(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1,p:1,backgroundColor:"grey.100",borderRadius:1,fontSize:"0.75rem"},children:e.notes})]}),(0,Y.jsxs)(re.A,{children:["image"===e.fileType&&(0,Y.jsx)(R.A,{size:"small",onClick:()=>(e=>{b(e),v(!0)})(e),title:"\u9884\u89c8",children:(0,Y.jsx)(le.A,{})}),(0,Y.jsx)(R.A,{size:"small",onClick:()=>(e=>{g(e),j(!0)})(e),color:"error",title:"\u5220\u9664",children:(0,Y.jsx)(J.A,{})})]})]},e._id);var t})})]}),(0,Y.jsxs)(A.A,{severity:"info",sx:{mt:3},children:[(0,Y.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:(0,Y.jsx)("strong",{children:"\u4f7f\u7528\u8bf4\u660e\uff1a"})}),(0,Y.jsxs)(l.A,{variant:"body2",component:"div",children:["\u2022 ",(0,Y.jsx)("strong",{children:"\u56fe\u7247\u6587\u4ef6\uff1a"}),"\u53ef\u4ee5\u4e0a\u4f20\u8bfe\u8868\u622a\u56fe\uff0c\u65b9\u4fbf\u67e5\u770b\u548c\u5907\u4efd",(0,Y.jsx)("br",{}),"\u2022 ",(0,Y.jsx)("strong",{children:"Excel\u6587\u4ef6\uff1a"}),"\u53ef\u4ee5\u4e0a\u4f20\u8bfe\u8868\u6570\u636e\u6587\u4ef6\uff0c\u540e\u7eed\u53ef\u80fd\u652f\u6301\u81ea\u52a8\u89e3\u6790",(0,Y.jsx)("br",{}),"\u2022 ",(0,Y.jsx)("strong",{children:"\u6587\u4ef6\u7ba1\u7406\uff1a"}),"\u652f\u6301\u9884\u89c8\u56fe\u7247\u6587\u4ef6\u548c\u5220\u9664\u4e0d\u9700\u8981\u7684\u6587\u4ef6",(0,Y.jsx)("br",{}),"\u2022 ",(0,Y.jsx)("strong",{children:"\u5907\u6ce8\u529f\u80fd\uff1a"}),"\u4e3a\u6bcf\u4e2a\u6587\u4ef6\u6dfb\u52a0\u5907\u6ce8\uff0c\u65b9\u4fbf\u8bc6\u522b\u548c\u7ba1\u7406"]})]}),(0,Y.jsxs)(_.A,{open:m,onClose:P,maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(O.A,{children:"\u786e\u8ba4\u5220\u9664\u6587\u4ef6"}),(0,Y.jsxs)(L.A,{children:[(0,Y.jsxs)(l.A,{children:['\u786e\u5b9a\u8981\u5220\u9664\u6587\u4ef6 "',null===p||void 0===p?void 0:p.originalName,'" \u5417\uff1f']}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"\u6b64\u64cd\u4f5c\u4e0d\u53ef\u64a4\u9500\u3002"})]}),(0,Y.jsxs)(G.A,{children:[(0,Y.jsx)(z.A,{onClick:P,children:"\u53d6\u6d88"}),(0,Y.jsx)(z.A,{onClick:async()=>{if(p)try{await S.deleteUploadedFile(p._id),T(),j(!1),g(null)}catch(e){r("\u5220\u9664\u6587\u4ef6\u5931\u8d25"),console.error("\u5220\u9664\u6587\u4ef6\u5931\u8d25:",e)}},color:"error",variant:"contained",children:"\u5220\u9664"})]})]}),(0,Y.jsxs)(_.A,{open:y,onClose:M,maxWidth:"md",fullWidth:!0,children:[(0,Y.jsxs)(O.A,{children:["\u56fe\u7247\u9884\u89c8 - ",null===f||void 0===f?void 0:f.originalName]}),(0,Y.jsx)(L.A,{children:f&&(0,Y.jsx)(a.A,{component:"img",src:"/api/schedule/files/".concat(f._id,"/preview"),alt:f.originalName,sx:{width:"100%",height:"auto",maxHeight:"70vh",objectFit:"contain"},onError:e=>{e.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7ml6Dms5XpooTop4jlm748L3RleHQ+PC9zdmc+"}})}),(0,Y.jsx)(G.A,{children:(0,Y.jsx)(z.A,{onClick:M,children:"\u5173\u95ed"})})]})]})};var ce=r(17205),de=r(36649),xe=r(76088);const he=e=>{let{open:t,course:r,onClose:n,onSubmit:i,loading:c}=e;const[d,x]=(0,s.useState)({name:"",courseCode:"",teacher:"",department:"",credits:1,description:"",tags:[],color:"#FF6B6B",rating:0,review:"",isActive:!0}),[h,u]=(0,s.useState)([]),[m,p]=(0,s.useState)([]),[g,y]=(0,s.useState)({}),[v,f]=(0,s.useState)(!1),b=S.getDefaultColors();(0,s.useEffect)(()=>{t&&(C(),w(),x(r?{name:r.name,courseCode:r.courseCode,teacher:r.teacher,department:r.department,credits:r.credits,description:r.description||"",tags:r.tags,color:r.color,rating:r.rating||0,review:r.review||"",isActive:r.isActive}:{name:"",courseCode:"",teacher:"",department:"",credits:1,description:"",tags:[],color:S.getRandomColor(),rating:0,review:"",isActive:!0}),y({}))},[t,r]);const C=async()=>{try{const e=await S.getDepartments();e.success&&e.data&&u(e.data)}catch(e){console.error("\u52a0\u8f7d\u9662\u7cfb\u5217\u8868\u5931\u8d25:",e)}},w=async()=>{try{const e=await S.getCourseTags();e.success&&e.data&&p(e.data)}catch(e){console.error("\u52a0\u8f7d\u6807\u7b7e\u5217\u8868\u5931\u8d25:",e)}},T=e=>t=>{const r=t.target.value;x(t=>(0,o.A)((0,o.A)({},t),{},{[e]:"credits"===e||"rating"===e?parseFloat(r)||0:r})),g[e]&&y(t=>{const r=(0,o.A)({},t);return delete r[e],r})};return(0,Y.jsxs)(_.A,{open:t,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[(0,Y.jsx)(O.A,{children:r?"\u7f16\u8f91\u8bfe\u7a0b":"\u6dfb\u52a0\u8bfe\u7a0b"}),(0,Y.jsxs)(L.A,{children:[(0,Y.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u57fa\u672c\u4fe1\u606f"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u8bfe\u7a0b\u540d\u79f0",value:d.name,onChange:T("name"),error:!!g.name,helperText:g.name,required:!0})}),(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u8bfe\u7a0b\u4ee3\u7801",value:d.courseCode,onChange:T("courseCode"),error:!!g.courseCode,helperText:g.courseCode,required:!0})})]}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u6559\u5e08\u59d3\u540d",value:d.teacher,onChange:T("teacher"),error:!!g.teacher,helperText:g.teacher,required:!0})}),(0,Y.jsx)(a.A,{children:(0,Y.jsxs)(D.A,{fullWidth:!0,error:!!g.department,children:[(0,Y.jsx)(W.A,{children:"\u9662\u7cfb"}),(0,Y.jsxs)(I.A,{value:d.department,label:"\u9662\u7cfb",onChange:(H="department",e=>{x(t=>(0,o.A)((0,o.A)({},t),{},{[H]:e.target.value})),g[H]&&y(e=>{const t=(0,o.A)({},e);return delete t[H],t})}),children:[h.map(e=>(0,Y.jsx)(B.A,{value:e,children:e},e)),(0,Y.jsx)(B.A,{value:"\u5176\u4ed6",children:"\u5176\u4ed6"})]}),g.department&&(0,Y.jsx)(l.A,{variant:"caption",color:"error",sx:{ml:2,mt:.5},children:g.department})]})})]}),(0,Y.jsx)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u5b66\u5206",type:"number",value:d.credits,onChange:T("credits"),error:!!g.credits,helperText:g.credits,inputProps:{min:.5,max:10,step:.5},required:!0})})}),(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u8bfe\u7a0b\u63cf\u8ff0",multiline:!0,rows:3,value:d.description,onChange:T("description"),placeholder:"\u8bf7\u8f93\u5165\u8bfe\u7a0b\u7684\u8be6\u7ec6\u63cf\u8ff0..."})}),(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u6807\u7b7e\u548c\u5916\u89c2"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"2fr 1fr"},gap:2},children:[(0,Y.jsx)(a.A,{children:(0,Y.jsx)(ce.A,{multiple:!0,freeSolo:!0,options:m,value:d.tags,onChange:(e,t)=>{x(e=>(0,o.A)((0,o.A)({},e),{},{tags:t}))},renderTags:(e,t)=>e.map((e,r)=>(0,s.createElement)(F.A,(0,o.A)((0,o.A)({variant:"outlined",label:e},t({index:r})),{},{key:r}))),renderInput:e=>(0,Y.jsx)(k.A,(0,o.A)((0,o.A)({},e),{},{label:"\u6807\u7b7e",placeholder:"\u8f93\u5165\u6807\u7b7e\u5e76\u6309\u56de\u8f66\u6dfb\u52a0"}))})}),(0,Y.jsx)(a.A,{children:(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u8bfe\u7a0b\u989c\u8272"}),(0,Y.jsx)(z.A,{variant:"outlined",startIcon:(0,Y.jsx)(de.A,{}),onClick:()=>f(!v),sx:{backgroundColor:d.color,color:"white","&:hover":{backgroundColor:d.color,opacity:.8}},children:"\u9009\u62e9\u989c\u8272"}),v&&(0,Y.jsx)(a.A,{sx:{mt:2,p:2,border:1,borderColor:"divider",borderRadius:1},children:(0,Y.jsx)(a.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:b.map(e=>(0,Y.jsx)(a.A,{sx:{width:32,height:32,backgroundColor:e,borderRadius:1,cursor:"pointer",border:d.color===e?3:1,borderColor:d.color===e?"primary.main":"divider","&:hover":{transform:"scale(1.1)"}},onClick:()=>(e=>{x(t=>(0,o.A)((0,o.A)({},t),{},{color:e})),f(!1)})(e)},e))})})]})})]}),(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u8bfe\u7a0b\u8bc4\u4ef7"}),(0,Y.jsx)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:(0,Y.jsx)(a.A,{children:(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u8bc4\u5206"}),(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",children:[(0,Y.jsx)(P.A,{value:d.rating,onChange:(e,t)=>{x(e=>(0,o.A)((0,o.A)({},e),{},{rating:t||0}))},precision:.5,size:"large",icon:(0,Y.jsx)(xe.A,{fontSize:"inherit"}),emptyIcon:(0,Y.jsx)(xe.A,{fontSize:"inherit"})}),(0,Y.jsx)(l.A,{variant:"body2",sx:{ml:1},children:d.rating&&d.rating>0?d.rating.toFixed(1):"\u672a\u8bc4\u5206"})]}),g.rating&&(0,Y.jsx)(l.A,{variant:"caption",color:"error",children:g.rating})]})})}),(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u8bfe\u7a0b\u8bc4\u4ef7",multiline:!0,rows:3,value:d.review,onChange:T("review"),placeholder:"\u8bf7\u8f93\u5165\u5bf9\u8fd9\u95e8\u8bfe\u7a0b\u7684\u8bc4\u4ef7\u548c\u5efa\u8bae..."})})]}),Object.keys(g).length>0&&(0,Y.jsx)(A.A,{severity:"error",sx:{mt:2},children:"\u8bf7\u68c0\u67e5\u5e76\u4fee\u6b63\u8868\u5355\u4e2d\u7684\u9519\u8bef"})]}),(0,Y.jsxs)(G.A,{sx:{p:3},children:[(0,Y.jsx)(z.A,{onClick:n,disabled:c,children:"\u53d6\u6d88"}),(0,Y.jsx)(z.A,{onClick:()=>{(()=>{const e={};return d.name.trim()||(e.name="\u8bfe\u7a0b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"),d.courseCode.trim()||(e.courseCode="\u8bfe\u7a0b\u4ee3\u7801\u4e0d\u80fd\u4e3a\u7a7a"),d.teacher.trim()||(e.teacher="\u6559\u5e08\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a"),d.department.trim()||(e.department="\u9662\u7cfb\u4e0d\u80fd\u4e3a\u7a7a"),(d.credits<.5||d.credits>10)&&(e.credits="\u5b66\u5206\u5fc5\u987b\u57280.5-10\u4e4b\u95f4"),void 0!==d.rating&&(d.rating<0||d.rating>5)&&(e.rating="\u8bc4\u5206\u5fc5\u987b\u57280-5\u4e4b\u95f4"),y(e),0===Object.keys(e).length})()&&i(d)},variant:"contained",disabled:c,startIcon:c?(0,Y.jsx)(j.A,{size:20}):null,children:c?"\u4fdd\u5b58\u4e2d...":r?"\u66f4\u65b0":"\u521b\u5efa"})]})]});var H};var ue=r(15010),me=r(44066),Ae=r(23031),je=r(4159),pe=r.n(je);const ge=e=>{var t;let{open:r,slot:n,courses:i,defaultDay:c,onClose:d,onSubmit:x,loading:h}=e;const[u,m]=(0,s.useState)({course:"",semester:"",dayOfWeek:1,startTime:"08:00",endTime:"09:40",location:"",weeks:[],notes:""}),[p,g]=(0,s.useState)({}),[y,v]=(0,s.useState)(pe()("08:00","HH:mm")),[f,b]=(0,s.useState)(pe()("09:40","HH:mm")),[C,w]=(0,s.useState)([]),[T,H]=(0,s.useState)(""),E=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],R=Array.from({length:20},(e,t)=>t+1);(0,s.useEffect)(()=>{if(r){if(n){const e="string"===typeof n.course?n.course:n.course._id||"";m({course:e,semester:n.semester,dayOfWeek:n.dayOfWeek,startTime:n.startTime,endTime:n.endTime,location:n.location,weeks:n.weeks,notes:n.notes||""}),v(pe()(n.startTime,"HH:mm")),b(pe()(n.endTime,"HH:mm")),w(n.weeks)}else m({course:"",semester:"2024-1",dayOfWeek:c,startTime:"08:00",endTime:"09:40",location:"",weeks:[],notes:""}),v(pe()("08:00","HH:mm")),b(pe()("09:40","HH:mm")),w([]);g({}),H("")}},[r,n,c]);const P=e=>t=>{const r=t.target.value;m(t=>(0,o.A)((0,o.A)({},t),{},{[e]:"dayOfWeek"===e?parseInt(r):r})),p[e]&&g(t=>{const r=(0,o.A)({},t);return delete r[e],r})},M=e=>t=>{m(r=>(0,o.A)((0,o.A)({},r),{},{[e]:t.target.value})),p[e]&&g(t=>{const r=(0,o.A)({},t);return delete r[e],r})},N=e=>{let t=[];switch(e){case"all":t=R;break;case"odd":t=R.filter(e=>e%2===1);break;case"even":t=R.filter(e=>e%2===0);break;case"first-half":t=R.slice(0,10);break;case"second-half":t=R.slice(10);break;case"clear":t=[]}w(t),m(e=>(0,o.A)((0,o.A)({},e),{},{weeks:t})),H(e)};return(0,Y.jsx)(ue.$J,{dateAdapter:me.R,children:(0,Y.jsxs)(_.A,{open:r,onClose:d,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[(0,Y.jsx)(O.A,{children:n?"\u7f16\u8f91\u8bfe\u7a0b\u5b89\u6392":"\u6dfb\u52a0\u8bfe\u7a0b\u5b89\u6392"}),(0,Y.jsxs)(L.A,{children:[(0,Y.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u57fa\u672c\u4fe1\u606f"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[(0,Y.jsx)(a.A,{children:(0,Y.jsxs)(D.A,{fullWidth:!0,error:!!p.course,children:[(0,Y.jsx)(W.A,{children:"\u9009\u62e9\u8bfe\u7a0b"}),(0,Y.jsx)(I.A,{value:u.course,label:"\u9009\u62e9\u8bfe\u7a0b",onChange:M("course"),children:i.map(e=>(0,Y.jsx)(B.A,{value:e._id,children:(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",children:[(0,Y.jsx)(a.A,{sx:{width:16,height:16,backgroundColor:e.color,borderRadius:1,mr:1}}),e.name," (",e.courseCode,")"]})},e._id))}),p.course&&(0,Y.jsx)(l.A,{variant:"caption",color:"error",sx:{ml:2,mt:.5},children:p.course})]})}),(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u5b66\u671f",value:u.semester,onChange:P("semester"),error:!!p.semester,helperText:p.semester,placeholder:"\u5982\uff1a2024-1",required:!0})})]}),(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u65f6\u95f4\u5b89\u6392"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[(0,Y.jsx)(a.A,{children:(0,Y.jsxs)(D.A,{fullWidth:!0,children:[(0,Y.jsx)(W.A,{children:"\u661f\u671f"}),(0,Y.jsx)(I.A,{value:u.dayOfWeek,label:"\u661f\u671f",onChange:M("dayOfWeek"),children:E.map((e,t)=>(0,Y.jsx)(B.A,{value:t,children:e},t))})]})}),(0,Y.jsx)(a.A,{children:(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u4e0a\u8bfe\u5730\u70b9",value:u.location,onChange:P("location"),error:!!p.location,helperText:p.location,InputProps:{startAdornment:(0,Y.jsx)(V.A,{sx:{mr:1,color:"text.secondary"}})},required:!0})})]}),(0,Y.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u5feb\u901f\u9009\u62e9\u65f6\u95f4\u6bb5"}),(0,Y.jsx)(a.A,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:[{label:"\u7b2c1\u8282\u8bfe",startTime:"08:00",endTime:"09:40"},{label:"\u7b2c2\u8282\u8bfe",startTime:"10:00",endTime:"11:40"},{label:"\u7b2c3\u8282\u8bfe",startTime:"14:00",endTime:"15:40"},{label:"\u7b2c4\u8282\u8bfe",startTime:"16:00",endTime:"17:40"},{label:"\u7b2c5\u8282\u8bfe",startTime:"19:00",endTime:"20:40"}].map(e=>(0,Y.jsx)(F.A,{label:"".concat(e.label," (").concat(e.startTime,"-").concat(e.endTime,")"),onClick:()=>(e=>{v(pe()(e.startTime,"HH:mm")),b(pe()(e.endTime,"HH:mm")),m(t=>(0,o.A)((0,o.A)({},t),{},{startTime:e.startTime,endTime:e.endTime}))})(e),variant:"outlined",clickable:!0},e.label))}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[(0,Y.jsx)(a.A,{children:(0,Y.jsx)(Ae.A,{label:"\u5f00\u59cb\u65f6\u95f4",value:y,onChange:e=>{v(e),e&&m(t=>(0,o.A)((0,o.A)({},t),{},{startTime:e.format("HH:mm")}))},slotProps:{textField:{fullWidth:!0,error:!!p.time,helperText:p.time}}})}),(0,Y.jsx)(a.A,{children:(0,Y.jsx)(Ae.A,{label:"\u7ed3\u675f\u65f6\u95f4",value:f,onChange:e=>{b(e),e&&m(t=>(0,o.A)((0,o.A)({},t),{},{endTime:e.format("HH:mm")}))},slotProps:{textField:{fullWidth:!0}}})})]}),(0,Y.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"\u4e0a\u8bfe\u5468\u6b21"}),(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"body2",gutterBottom:!0,children:"\u5feb\u901f\u9009\u62e9"}),(0,Y.jsxs)(a.A,{display:"flex",flexWrap:"wrap",gap:1,mb:2,children:[(0,Y.jsx)(z.A,{size:"small",variant:"all"===T?"contained":"outlined",onClick:()=>N("all"),children:"\u5168\u9009"}),(0,Y.jsx)(z.A,{size:"small",variant:"odd"===T?"contained":"outlined",onClick:()=>N("odd"),children:"\u5355\u5468"}),(0,Y.jsx)(z.A,{size:"small",variant:"even"===T?"contained":"outlined",onClick:()=>N("even"),children:"\u53cc\u5468"}),(0,Y.jsx)(z.A,{size:"small",variant:"first-half"===T?"contained":"outlined",onClick:()=>N("first-half"),children:"\u524d10\u5468"}),(0,Y.jsx)(z.A,{size:"small",variant:"second-half"===T?"contained":"outlined",onClick:()=>N("second-half"),children:"\u540e10\u5468"}),(0,Y.jsx)(z.A,{size:"small",variant:"clear"===T?"contained":"outlined",onClick:()=>N("clear"),color:"error",children:"\u6e05\u7a7a"})]})]}),(0,Y.jsxs)(a.A,{children:[(0,Y.jsxs)(l.A,{variant:"body2",gutterBottom:!0,children:["\u9009\u62e9\u5177\u4f53\u5468\u6b21\uff08\u5df2\u9009\u62e9 ",C.length," \u5468\uff09"]}),(0,Y.jsx)(a.A,{display:"flex",flexWrap:"wrap",gap:1,children:R.map(e=>(0,Y.jsx)(F.A,{label:"\u7b2c".concat(e,"\u5468"),onClick:()=>(e=>{const t=C.includes(e)?C.filter(t=>t!==e):[...C,e].sort((e,t)=>e-t);w(t),m(e=>(0,o.A)((0,o.A)({},e),{},{weeks:t})),p.weeks&&g(e=>{const t=(0,o.A)({},e);return delete t.weeks,t})})(e),color:C.includes(e)?"primary":"default",variant:C.includes(e)?"filled":"outlined",clickable:!0},e))}),p.weeks&&(0,Y.jsx)(l.A,{variant:"caption",color:"error",sx:{mt:1,display:"block"},children:p.weeks})]}),(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u5907\u6ce8",multiline:!0,rows:3,value:u.notes,onChange:P("notes"),placeholder:"\u8bf7\u8f93\u5165\u8bfe\u7a0b\u5b89\u6392\u7684\u5907\u6ce8\u4fe1\u606f..."}),u.course&&(0,Y.jsx)(a.A,{sx:{mt:2},children:(0,Y.jsx)(A.A,{severity:"info",children:(0,Y.jsxs)(l.A,{variant:"body2",children:[(0,Y.jsx)("strong",{children:"\u8bfe\u7a0b\u5b89\u6392\u9884\u89c8\uff1a"}),null===(U="string"===typeof u.course?u.course:u.course._id||"",t=i.find(e=>e._id===U))||void 0===t?void 0:t.name," -",E[u.dayOfWeek],null===y||void 0===y?void 0:y.format("HH:mm"),"-",null===f||void 0===f?void 0:f.format("HH:mm")," -",u.location," -",S.getWeeksDisplay(C)]})})})]}),Object.keys(p).length>0&&(0,Y.jsx)(A.A,{severity:"error",sx:{mt:2},children:"\u8bf7\u68c0\u67e5\u5e76\u4fee\u6b63\u8868\u5355\u4e2d\u7684\u9519\u8bef"})]}),(0,Y.jsxs)(G.A,{sx:{p:3},children:[(0,Y.jsx)(z.A,{onClick:d,disabled:h,children:"\u53d6\u6d88"}),(0,Y.jsx)(z.A,{onClick:()=>{(()=>{const e={};return u.course||(e.course="\u8bf7\u9009\u62e9\u8bfe\u7a0b"),u.semester||(e.semester="\u8bf7\u8f93\u5165\u5b66\u671f"),u.location.trim()||(e.location="\u8bf7\u8f93\u5165\u4e0a\u8bfe\u5730\u70b9"),0===u.weeks.length&&(e.weeks="\u8bf7\u9009\u62e9\u4e0a\u8bfe\u5468\u6b21"),y&&f&&y.isAfter(f)&&(e.time="\u5f00\u59cb\u65f6\u95f4\u4e0d\u80fd\u665a\u4e8e\u7ed3\u675f\u65f6\u95f4"),g(e),0===Object.keys(e).length})()&&x((0,o.A)((0,o.A)({},u),{},{startTime:(null===y||void 0===y?void 0:y.format("HH:mm"))||"08:00",endTime:(null===f||void 0===f?void 0:f.format("HH:mm"))||"09:40",weeks:C}))},variant:"contained",disabled:h,startIcon:h?(0,Y.jsx)(j.A,{size:20}):null,children:h?"\u4fdd\u5b58\u4e2d...":n?"\u66f4\u65b0":"\u6dfb\u52a0"})]})]})});var U};var ye=r(55884),ve=r(41680),fe=r(30817),be=r(26309);const Ce=e=>{let{onSave:t}=e;const[r,n]=(0,s.useState)({startTime:"08:00",endTime:"22:00",timeSlotDuration:50,breakDuration:10,showWeekends:!1,defaultSemester:"2024-1",autoSave:!0}),i=e=>t=>{const r="checkbox"===t.target.type?t.target.checked:t.target.value;n(t=>(0,o.A)((0,o.A)({},t),{},{[e]:r}))};return(0,Y.jsxs)(d.A,{sx:{p:3,maxWidth:600,mx:"auto"},children:[(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:3,children:[(0,Y.jsx)(v.A,{sx:{mr:1}}),(0,Y.jsx)(l.A,{variant:"h6",children:"\u8bfe\u8868\u6a21\u677f\u8bbe\u7f6e"})]}),(0,Y.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"\u65f6\u95f4\u8bbe\u7f6e"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[(0,Y.jsx)(k.A,{label:"\u5f00\u59cb\u65f6\u95f4",type:"time",value:r.startTime,onChange:i("startTime"),InputLabelProps:{shrink:!0}}),(0,Y.jsx)(k.A,{label:"\u7ed3\u675f\u65f6\u95f4",type:"time",value:r.endTime,onChange:i("endTime"),InputLabelProps:{shrink:!0}})]})]}),(0,Y.jsx)(ye.A,{}),(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"\u8bfe\u7a0b\u8bbe\u7f6e"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[(0,Y.jsx)(k.A,{label:"\u8bfe\u7a0b\u65f6\u957f\uff08\u5206\u949f\uff09",type:"number",value:r.timeSlotDuration,onChange:i("timeSlotDuration"),inputProps:{min:30,max:120,step:5}}),(0,Y.jsx)(k.A,{label:"\u8bfe\u95f4\u4f11\u606f\uff08\u5206\u949f\uff09",type:"number",value:r.breakDuration,onChange:i("breakDuration"),inputProps:{min:5,max:30,step:5}})]})]}),(0,Y.jsx)(ye.A,{}),(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"\u663e\u793a\u8bbe\u7f6e"}),(0,Y.jsx)(ve.A,{control:(0,Y.jsx)(fe.A,{checked:r.showWeekends,onChange:i("showWeekends")}),label:"\u663e\u793a\u5468\u672b"})]}),(0,Y.jsx)(ye.A,{}),(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"\u9ed8\u8ba4\u8bbe\u7f6e"}),(0,Y.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:"1fr",gap:2},children:[(0,Y.jsx)(k.A,{label:"\u9ed8\u8ba4\u5b66\u671f",value:r.defaultSemester,onChange:i("defaultSemester"),placeholder:"\u4f8b\u5982\uff1a2024-1"}),(0,Y.jsx)(ve.A,{control:(0,Y.jsx)(fe.A,{checked:r.autoSave,onChange:i("autoSave")}),label:"\u81ea\u52a8\u4fdd\u5b58"})]})]}),(0,Y.jsx)(a.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,Y.jsx)(z.A,{variant:"contained",startIcon:(0,Y.jsx)(be.A,{}),onClick:()=>{t&&t(r),localStorage.setItem("scheduleSettings",JSON.stringify(r))},children:"\u4fdd\u5b58\u8bbe\u7f6e"})})]})]})};var we=r(4840),Se=r(28493),ke=r(21457),Te=r(81393),De=r(4755),We=r(10614),Ie=r(61106),Be=r(25269),ze=r(87631),He=r(50943),Ee=r(33588),Re=r(48767),Fe=r(39172),Pe=r(71257),Me=r(53238),_e=r(84453),Oe=r(81095),Le=r(37651),Ge=r(93245),Ne=r(60158),Ue=r(73440),Ke=r(54725),qe=r(87202),Ze=r(38871);const Je=e=>{var t,r,n,i,c,x,h,u,m;let{currentSchedule:g,currentCourses:y,currentSemester:v}=e;const[f,w]=(0,s.useState)([]),[T,D]=(0,s.useState)([]),[W,I]=(0,s.useState)(null),[B,R]=(0,s.useState)(!1),[P,M]=(0,s.useState)(!1),[N,U]=(0,s.useState)({name:"",description:"",isPublic:!0}),[K,q]=(0,s.useState)(null),[Z,J]=(0,s.useState)(null),Q=["","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d","\u5468\u65e5"];(0,s.useEffect)(()=>{V()},[]);const V=async()=>{try{R(!0);const e=await S.getPublicSharedSchedules({semester:v,page:1,limit:20});if(!e.success||!e.data)throw new Error(e.message||"\u83b7\u53d6\u5171\u4eab\u8bfe\u8868\u5931\u8d25");w(e.data.schedules)}catch(K){q("\u52a0\u8f7d\u5171\u4eab\u8bfe\u8868\u5931\u8d25"),console.error("\u52a0\u8f7d\u5171\u4eab\u8bfe\u8868\u5931\u8d25:",K)}finally{R(!1)}};return(0,Y.jsxs)(a.A,{children:[(0,Y.jsxs)(d.A,{sx:{p:3,mb:3},children:[(0,Y.jsxs)(a.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,Y.jsx)(l.A,{variant:"h6",children:"\u5206\u4eab\u6211\u7684\u8bfe\u8868"}),(0,Y.jsx)(z.A,{variant:"contained",startIcon:(0,Y.jsx)(Pe.A,{}),onClick:()=>M(!0),children:"\u5206\u4eab\u8bfe\u8868"})]}),(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"\u5c06\u60a8\u7684\u8bfe\u8868\u5206\u4eab\u7ed9\u5176\u4ed6\u7528\u6237\uff0c\u4fbf\u4e8e\u8fdb\u884c\u8bfe\u8868\u6bd4\u5bf9\u548c\u65f6\u95f4\u534f\u8c03"})]}),(0,Y.jsxs)(d.A,{sx:{p:3,mb:3},children:[(0,Y.jsxs)(l.A,{variant:"h6",gutterBottom:!0,children:["\u53ef\u6bd4\u5bf9\u7684\u8bfe\u8868 (",f.length,")"]}),B?(0,Y.jsx)(a.A,{display:"flex",justifyContent:"center",p:3,children:(0,Y.jsx)(j.A,{})}):0===f.length?(0,Y.jsx)(A.A,{severity:"info",children:"\u6682\u65e0\u53ef\u6bd4\u5bf9\u7684\u8bfe\u8868\uff0c\u8bf7\u5148\u5206\u4eab\u60a8\u7684\u8bfe\u8868\u6216\u7b49\u5f85\u5176\u4ed6\u7528\u6237\u5206\u4eab"}):(0,Y.jsx)(a.A,{display:"flex",flexWrap:"wrap",gap:2,children:f.map(e=>(0,Y.jsx)(a.A,{sx:{width:{xs:"100%",sm:"calc(50% - 8px)",md:"calc(33.333% - 11px)"}},children:(0,Y.jsx)(H.A,{sx:{cursor:"pointer",border:T.includes(e._id)?2:1,borderColor:T.includes(e._id)?"primary.main":"divider"},onClick:()=>{return t=e._id,void D(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},children:(0,Y.jsxs)(E.A,{children:[(0,Y.jsxs)(a.A,{display:"flex",alignItems:"center",mb:1,children:[(0,Y.jsx)(p.A,{sx:{mr:1,color:"primary.main"}}),(0,Y.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:e.name})]}),(0,Y.jsxs)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["\u5206\u4eab\u8005\uff1a",e.owner]}),e.description&&(0,Y.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.description}),(0,Y.jsx)(a.A,{mt:1,children:(0,Y.jsx)(F.A,{label:e.isPublic?"\u516c\u5f00":"\u79c1\u6709",size:"small",color:e.isPublic?"success":"default"})})]})})},e._id))}),T.length>0&&(0,Y.jsx)(a.A,{mt:3,display:"flex",justifyContent:"center",children:(0,Y.jsxs)(z.A,{variant:"contained",size:"large",startIcon:(0,Y.jsx)(C.A,{}),onClick:async()=>{if(0!==T.length)try{R(!0);const e=await S.compareSchedules(T);if(!e.success||!e.data)throw new Error(e.message);I(e.data),J("\u8bfe\u8868\u6bd4\u5bf9\u5206\u6790\u5b8c\u6210")}catch(K){q("\u8bfe\u8868\u6bd4\u5bf9\u5931\u8d25"),console.error("\u8bfe\u8868\u6bd4\u5bf9\u5931\u8d25:",K)}finally{R(!1)}else q("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u8bfe\u8868\u8fdb\u884c\u6bd4\u5bf9")},disabled:B,children:["\u5f00\u59cb\u6bd4\u5bf9\u5206\u6790 (",T.length+1,"\u4e2a\u8bfe\u8868)"]})})]}),W&&(0,Y.jsxs)(d.A,{sx:{p:3},children:[(0,Y.jsxs)(l.A,{variant:"h6",gutterBottom:!0,children:[(0,Y.jsx)(Me.A,{sx:{mr:1,verticalAlign:"middle"}}),"\u6bd4\u5bf9\u5206\u6790\u7ed3\u679c"]}),(0,Y.jsxs)(we.A,{defaultExpanded:!0,children:[(0,Y.jsx)(Se.A,{expandIcon:(0,Y.jsx)(_e.A,{}),children:(0,Y.jsx)(l.A,{variant:"subtitle1",children:"\u8bfe\u8868\u7edf\u8ba1\u5bf9\u6bd4"})}),(0,Y.jsx)(ke.A,{children:(()=>{var e,t,r;if(!W)return null;const s=(null===(e=W.analysis)||void 0===e||null===(t=e.statistics)||void 0===t||null===(r=t.scheduleStats)||void 0===r?void 0:r.map(e=>({name:e.name,"\u8bfe\u7a0b\u6570":e.totalCourses,"\u5b66\u5206\u6570":e.totalCredits,"\u5fd9\u788c\u65f6\u95f4":e.busyHours,"\u7a7a\u95f2\u65f6\u95f4":e.freeHours||0})))||[];return(0,Y.jsx)(Oe.u,{width:"100%",height:300,children:(0,Y.jsxs)(Le.E,{data:s,children:[(0,Y.jsx)(Ge.d,{strokeDasharray:"3 3"}),(0,Y.jsx)(Ne.W,{dataKey:"name"}),(0,Y.jsx)(Ue.h,{}),(0,Y.jsx)(Ke.m,{}),(0,Y.jsx)(qe.s,{}),(0,Y.jsx)(Ze.y,{dataKey:"\u8bfe\u7a0b\u6570",fill:"#8884d8"}),(0,Y.jsx)(Ze.y,{dataKey:"\u5b66\u5206\u6570",fill:"#82ca9d"}),(0,Y.jsx)(Ze.y,{dataKey:"\u5fd9\u788c\u65f6\u95f4",fill:"#ffc658"}),(0,Y.jsx)(Ze.y,{dataKey:"\u7a7a\u95f2\u65f6\u95f4",fill:"#ff7300"})]})})})()})]}),(0,Y.jsxs)(we.A,{children:[(0,Y.jsx)(Se.A,{expandIcon:(0,Y.jsx)(_e.A,{}),children:(0,Y.jsxs)(l.A,{variant:"subtitle1",children:["\u5171\u540c\u8bfe\u7a0b (",(null===(t=W.analysis)||void 0===t||null===(r=t.commonCourses)||void 0===r?void 0:r.length)||0,")"]})}),(0,Y.jsx)(ke.A,{children:null!==(n=W.analysis)&&void 0!==n&&n.commonCourses&&0!==W.analysis.commonCourses.length?(0,Y.jsx)(Te.A,{children:W.analysis.commonCourses.map((e,t)=>(0,Y.jsxs)(De.Ay,{children:[(0,Y.jsx)(We.A,{children:(0,Y.jsx)(b.A,{})}),(0,Y.jsx)(Ie.A,{primary:e})]},t))}):(0,Y.jsx)(l.A,{color:"text.secondary",children:"\u6ca1\u6709\u5171\u540c\u8bfe\u7a0b"})})]}),(0,Y.jsxs)(we.A,{children:[(0,Y.jsx)(Se.A,{expandIcon:(0,Y.jsx)(_e.A,{}),children:(0,Y.jsxs)(l.A,{variant:"subtitle1",children:["\u5171\u540c\u7a7a\u95f2\u65f6\u95f4 (",(null===(i=W.analysis)||void 0===i||null===(c=i.commonFreeTime)||void 0===c?void 0:c.length)||0,")"]})}),(0,Y.jsx)(ke.A,{children:null!==(x=W.analysis)&&void 0!==x&&x.commonFreeTime&&0!==W.analysis.commonFreeTime.length?(0,Y.jsx)(Be.A,{children:(0,Y.jsxs)(ze.A,{size:"small",children:[(0,Y.jsx)(He.A,{children:(0,Y.jsxs)(Ee.A,{children:[(0,Y.jsx)(Re.A,{children:"\u661f\u671f"}),(0,Y.jsx)(Re.A,{children:"\u5f00\u59cb\u65f6\u95f4"}),(0,Y.jsx)(Re.A,{children:"\u7ed3\u675f\u65f6\u95f4"}),(0,Y.jsx)(Re.A,{children:"\u65f6\u957f"})]})}),(0,Y.jsx)(Fe.A,{children:W.analysis.commonFreeTime.map((e,t)=>{const r=e.duration||0;return(0,Y.jsxs)(Ee.A,{children:[(0,Y.jsx)(Re.A,{children:Q[e.day]}),(0,Y.jsx)(Re.A,{children:e.startTime}),(0,Y.jsx)(Re.A,{children:e.endTime}),(0,Y.jsxs)(Re.A,{children:[Math.floor(r/60),"\u5c0f\u65f6",r%60,"\u5206\u949f"]})]},t)})})]})}):(0,Y.jsx)(l.A,{color:"text.secondary",children:"\u6ca1\u6709\u5171\u540c\u7a7a\u95f2\u65f6\u95f4"})})]}),(0,Y.jsxs)(we.A,{children:[(0,Y.jsx)(Se.A,{expandIcon:(0,Y.jsx)(_e.A,{}),children:(0,Y.jsxs)(l.A,{variant:"subtitle1",children:["\u65f6\u95f4\u51b2\u7a81 (",(null===(h=W.analysis)||void 0===h||null===(u=h.timeConflicts)||void 0===u?void 0:u.length)||0,")"]})}),(0,Y.jsx)(ke.A,{children:null!==(m=W.analysis)&&void 0!==m&&m.timeConflicts&&0!==W.analysis.timeConflicts.length?(0,Y.jsx)(Be.A,{children:(0,Y.jsxs)(ze.A,{size:"small",children:[(0,Y.jsx)(He.A,{children:(0,Y.jsxs)(Ee.A,{children:[(0,Y.jsx)(Re.A,{children:"\u661f\u671f"}),(0,Y.jsx)(Re.A,{children:"\u65f6\u95f4\u6bb5"}),(0,Y.jsx)(Re.A,{children:"\u51b2\u7a81\u8bfe\u7a0b"})]})}),(0,Y.jsx)(Fe.A,{children:W.analysis.timeConflicts.map((e,t)=>{var r;return(0,Y.jsxs)(Ee.A,{children:[(0,Y.jsx)(Re.A,{children:Q[e.day]}),(0,Y.jsxs)(Re.A,{children:[e.startTime," - ",e.endTime]}),(0,Y.jsx)(Re.A,{children:null===(r=e.courses)||void 0===r?void 0:r.map((e,t)=>(0,Y.jsx)(F.A,{label:e,size:"small",color:"error",sx:{mr:.5,mb:.5}},t))})]},t)})})]})}):(0,Y.jsx)(A.A,{severity:"success",children:"\u6ca1\u6709\u65f6\u95f4\u51b2\u7a81\uff0c\u8bfe\u8868\u5b89\u6392\u5408\u7406"})})]}),(0,Y.jsxs)(we.A,{children:[(0,Y.jsx)(Se.A,{expandIcon:(0,Y.jsx)(_e.A,{}),children:(0,Y.jsx)(l.A,{variant:"subtitle1",children:"\u8bfe\u8868\u7edf\u8ba1\u4fe1\u606f"})}),(0,Y.jsx)(ke.A,{children:(0,Y.jsx)(Be.A,{children:(0,Y.jsxs)(ze.A,{size:"small",children:[(0,Y.jsx)(He.A,{children:(0,Y.jsxs)(Ee.A,{children:[(0,Y.jsx)(Re.A,{children:"\u8bfe\u8868\u540d\u79f0"}),(0,Y.jsx)(Re.A,{children:"\u62e5\u6709\u8005"}),(0,Y.jsx)(Re.A,{children:"\u8bfe\u7a0b\u6570"}),(0,Y.jsx)(Re.A,{children:"\u5b66\u5206"}),(0,Y.jsx)(Re.A,{children:"\u5fd9\u788c\u65f6\u95f4"}),(0,Y.jsx)(Re.A,{children:"\u5e73\u5747\u8bc4\u5206"})]})}),(0,Y.jsx)(Fe.A,{children:W.analysis.statistics.scheduleStats.map((e,t)=>(0,Y.jsxs)(Ee.A,{children:[(0,Y.jsx)(Re.A,{children:e.name}),(0,Y.jsx)(Re.A,{children:e.owner}),(0,Y.jsx)(Re.A,{children:e.totalCourses}),(0,Y.jsx)(Re.A,{children:e.totalCredits}),(0,Y.jsxs)(Re.A,{children:[e.busyHours,"h"]}),(0,Y.jsx)(Re.A,{children:e.averageRating.toFixed(1)})]},t))})]})})})]})]}),(0,Y.jsxs)(_.A,{open:P,onClose:()=>M(!1),maxWidth:"sm",fullWidth:!0,children:[(0,Y.jsx)(O.A,{children:"\u5206\u4eab\u6211\u7684\u8bfe\u8868"}),(0,Y.jsx)(L.A,{children:(0,Y.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u8bfe\u8868\u540d\u79f0",value:N.name,onChange:e=>U(t=>(0,o.A)((0,o.A)({},t),{},{name:e.target.value})),placeholder:"\u4f8b\u5982\uff1a\u5f20\u4e09\u76842024\u6625\u5b63\u8bfe\u8868",required:!0}),(0,Y.jsx)(k.A,{fullWidth:!0,label:"\u8bfe\u8868\u63cf\u8ff0",value:N.description,onChange:e=>U(t=>(0,o.A)((0,o.A)({},t),{},{description:e.target.value})),placeholder:"\u7b80\u5355\u63cf\u8ff0\u60a8\u7684\u8bfe\u8868\u7279\u70b9",multiline:!0,rows:3}),(0,Y.jsx)(A.A,{severity:"info",children:"\u5206\u4eab\u540e\uff0c\u5176\u4ed6\u7528\u6237\u53ef\u4ee5\u770b\u5230\u60a8\u7684\u8bfe\u8868\u5e76\u4e0e\u60a8\u8fdb\u884c\u65f6\u95f4\u6bd4\u5bf9\u5206\u6790"})]})}),(0,Y.jsxs)(G.A,{children:[(0,Y.jsx)(z.A,{onClick:()=>M(!1),children:"\u53d6\u6d88"}),(0,Y.jsx)(z.A,{onClick:async()=>{try{R(!0);const e=await S.createSharedSchedule({name:N.name,owner:"current_user",description:N.description,semester:v,courseIds:y.map(e=>e._id).filter(e=>void 0!==e),scheduleSlotIds:Object.values(g).flat().map(e=>e._id).filter(e=>void 0!==e),isPublic:N.isPublic,tags:[]});if(!e.success||!e.data)throw new Error(e.message);J("\u8bfe\u8868\u5206\u4eab\u6210\u529f\uff01".concat(e.data.shareCode?"\u5206\u4eab\u7801: ".concat(e.data.shareCode):"")),V(),M(!1),U({name:"",description:"",isPublic:!0})}catch(K){q("\u5206\u4eab\u8bfe\u8868\u5931\u8d25"),console.error("\u5206\u4eab\u8bfe\u8868\u5931\u8d25:",K)}finally{R(!1)}},variant:"contained",disabled:!N.name.trim()||B,children:B?"\u5206\u4eab\u4e2d...":"\u786e\u8ba4\u5206\u4eab"})]})]}),K&&(0,Y.jsx)(A.A,{severity:"error",sx:{mt:2},onClose:()=>q(null),children:K}),Z&&(0,Y.jsx)(A.A,{severity:"success",sx:{mt:2},onClose:()=>J(null),children:Z})]})};var Ye=r(7356),Qe=r(57559),Ve=r(16253),Xe=r(59670),$e=r(42373),et=r(61323),tt=r(8806),rt=r(23644),st=r(40959),nt=r(66455),at=r(48605);const lt=e=>{let{schedule:t,courses:r,currentSemester:n,currentWeek:i,onSemesterChange:o,onWeekChange:c}=e;const x=(0,Ye.A)(),[h,u]=(0,s.useState)(new Date),[m,A]=(0,s.useState)("month"),[j,p]=(0,s.useState)([]),[g,y]=(0,s.useState)([]),v=["\u5468\u65e5","\u5468\u4e00","\u5468\u4e8c","\u5468\u4e09","\u5468\u56db","\u5468\u4e94","\u5468\u516d"],f=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];(0,s.useEffect)(()=>{C()},[]),(0,s.useEffect)(()=>{w()},[t,r,j,h]);const C=async()=>{try{var e;const t=await at.A.getReminders({page:1,limit:100,isCompleted:!1});t.success&&null!==(e=t.data)&&void 0!==e&&e.reminders&&p(t.data.reminders)}catch(t){console.error("\u52a0\u8f7d\u63d0\u9192\u5931\u8d25:",t)}},w=()=>{const e=[];Object.entries(t).forEach(t=>{let[s,n]=t;n.forEach(t=>{const n=r.find(e=>{var r;return e._id===t.course||e._id===(null===(r=t.course)||void 0===r?void 0:r._id)});if(n&&t.weeks.includes(i)){const r=S(parseInt(s),h);e.push({id:"course-".concat(t._id),title:n.name,type:"course",date:r,time:"".concat(t.startTime.substring(0,5),"-").concat(t.endTime.substring(0,5)),location:t.location,color:n.color||x.palette.primary.main,description:"\u6559\u5e08: ".concat(n.teacher)})}})}),r.forEach(t=>{if(t.examDate){const r=new Date(t.examDate);k(r)&&e.push({id:"exam-".concat(t._id),title:"".concat(t.name," \u8003\u8bd5"),type:"exam",date:r,time:t.examTime,location:t.examLocation,color:x.palette.error.main,description:"\u8003\u8bd5\u5f62\u5f0f: ".concat(t.examType||"\u672a\u77e5")})}}),j.forEach(t=>{const r=new Date(t.reminderTime);k(r)&&e.push({id:"reminder-".concat(t._id),title:t.title,type:"reminder",date:r,time:t.reminderTime.substring(11,16),color:T(t.priority),description:t.description})}),y(e)},S=(e,t)=>{const r=new Date(t),s=e-r.getDay();return r.setDate(r.getDate()+s),r},k=e=>{if("week"===m){const t=P(h),r=new Date(t);return r.setDate(r.getDate()+6),e>=t&&e<=r}return e.getMonth()===h.getMonth()&&e.getFullYear()===h.getFullYear()},T=e=>{switch(e){case"\u9ad8":return x.palette.error.main;case"\u4e2d":return x.palette.warning.main;case"\u4f4e":return x.palette.info.main;default:return x.palette.grey[500]}},P=e=>{const t=new Date(e),r=t.getDay(),s=t.getDate()-r;return new Date(t.setDate(s))},M=e=>g.filter(t=>t.date.toDateString()===e.toDateString()),_=e=>{const t=new Date(h);"prev"===e?t.setMonth(t.getMonth()-1):t.setMonth(t.getMonth()+1),u(t)},O=e=>{const t=new Date(h);"prev"===e?(t.setDate(t.getDate()-7),c(Math.max(1,i-1))):(t.setDate(t.getDate()+7),c(Math.min(20,i+1))),u(t)},L=e=>(0,Y.jsx)(Qe.A,{title:(0,Y.jsxs)(a.A,{children:[(0,Y.jsx)(l.A,{variant:"subtitle2",children:e.title}),e.time&&(0,Y.jsxs)(l.A,{variant:"caption",children:["\u65f6\u95f4: ",e.time]}),e.location&&(0,Y.jsxs)(l.A,{variant:"caption",children:["\u5730\u70b9: ",e.location]}),e.description&&(0,Y.jsx)(l.A,{variant:"caption",children:e.description})]}),children:(0,Y.jsx)(F.A,{icon:(()=>{switch(e.type){case"course":return(0,Y.jsx)(b.A,{sx:{fontSize:12}});case"exam":return(0,Y.jsx)($e.A,{sx:{fontSize:12}});case"reminder":return(0,Y.jsx)(et.A,{sx:{fontSize:12}});default:return(0,Y.jsx)(tt.A,{sx:{fontSize:12}})}})(),label:e.title,size:"small",sx:{backgroundColor:e.color,color:"white",fontSize:"0.7rem",height:20,mb:.5,maxWidth:"100%","& .MuiChip-label":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}})},e.id);return(0,Y.jsxs)(a.A,{children:[(0,Y.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,Y.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,Y.jsx)(l.A,{variant:"h5",sx:{fontWeight:"bold"},children:"month"===m?"".concat(h.getFullYear(),"\u5e74 ").concat(["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"][h.getMonth()]):"".concat(h.getFullYear(),"\u5e74 \u7b2c").concat(i,"\u5468")}),(0,Y.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,Y.jsx)(R.A,{onClick:()=>"month"===m?_("prev"):O("prev"),children:(0,Y.jsx)(rt.A,{})}),(0,Y.jsx)(R.A,{onClick:()=>{u(new Date)},children:(0,Y.jsx)(st.A,{})}),(0,Y.jsx)(R.A,{onClick:()=>"month"===m?_("next"):O("next"),children:(0,Y.jsx)(nt.A,{})})]})]}),(0,Y.jsxs)(a.A,{sx:{display:"flex",gap:2},children:[(0,Y.jsxs)(D.A,{size:"small",sx:{minWidth:120},children:[(0,Y.jsx)(W.A,{children:"\u5b66\u671f"}),(0,Y.jsxs)(I.A,{value:n,label:"\u5b66\u671f",onChange:e=>o(e.target.value),children:[(0,Y.jsx)(B.A,{value:"2024-1",children:"2024\u6625\u5b63"}),(0,Y.jsx)(B.A,{value:"2024-2",children:"2024\u79cb\u5b63"}),(0,Y.jsx)(B.A,{value:"2023-1",children:"2023\u6625\u5b63"}),(0,Y.jsx)(B.A,{value:"2023-2",children:"2023\u79cb\u5b63"})]})]}),(0,Y.jsx)(z.A,{variant:"month"===m?"contained":"outlined",onClick:()=>A("month"),size:"small",children:"\u6708\u89c6\u56fe"}),(0,Y.jsx)(z.A,{variant:"week"===m?"contained":"outlined",onClick:()=>A("week"),size:"small",children:"\u5468\u89c6\u56fe"})]})]}),(0,Y.jsxs)(a.A,{sx:{display:"flex",gap:2,mb:3},children:[(0,Y.jsx)(F.A,{icon:(0,Y.jsx)(b.A,{}),label:"\u8bfe\u7a0b: ".concat(g.filter(e=>"course"===e.type).length),color:"primary",variant:"outlined"}),(0,Y.jsx)(F.A,{icon:(0,Y.jsx)($e.A,{}),label:"\u8003\u8bd5: ".concat(g.filter(e=>"exam"===e.type).length),color:"error",variant:"outlined"}),(0,Y.jsx)(F.A,{icon:(0,Y.jsx)(et.A,{}),label:"\u63d0\u9192: ".concat(g.filter(e=>"reminder"===e.type).length),color:"warning",variant:"outlined"})]}),(0,Y.jsx)(d.A,{sx:{p:2},children:"month"===m?(()=>{const e=(()=>{const e=h.getFullYear(),t=h.getMonth(),r=new Date(e,t,1),s=(new Date(e,t+1,0),new Date(r));s.setDate(s.getDate()-r.getDay());const n=[];for(let a=0;a<42;a++)n.push(new Date(s)),s.setDate(s.getDate()+1);return n})();return(0,Y.jsxs)(Ve.A,{container:!0,spacing:1,children:[f.map((e,t)=>(0,Y.jsx)(a.A,{sx:{flex:"1 1 14.28%",textAlign:"center"},children:(0,Y.jsx)(l.A,{variant:"subtitle2",align:"center",sx:{fontWeight:"bold",color:0===t||6===t?"error.main":"text.primary",py:1},children:e})},t)),e.map((e,t)=>{const r=M(e),s=e.getMonth()===h.getMonth(),n=e.toDateString()===(new Date).toDateString();return(0,Y.jsx)(a.A,{sx:{flex:"1 1 14.28%"},children:(0,Y.jsx)(H.A,{sx:{minHeight:120,backgroundColor:s?"background.paper":"grey.50",border:n?2:1,borderColor:n?"primary.main":"divider",cursor:"pointer","&:hover":{backgroundColor:s?"action.hover":"grey.100"}},children:(0,Y.jsxs)(E.A,{sx:{p:1,"&:last-child":{pb:1}},children:[(0,Y.jsx)(l.A,{variant:"body2",sx:{fontWeight:n?"bold":"normal",color:s?"text.primary":"text.disabled",mb:1},children:e.getDate()}),(0,Y.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[r.slice(0,3).map(e=>L(e)),r.length>3&&(0,Y.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["+",r.length-3," \u66f4\u591a"]})]})]})})},t)})]})})():(()=>{const e=(()=>{const e=P(h),t=[];for(let r=0;r<7;r++){const s=new Date(e);s.setDate(s.getDate()+r),t.push(s)}return t})();return(0,Y.jsxs)(a.A,{children:[(0,Y.jsxs)(a.A,{sx:{display:"flex",mb:2},children:[(0,Y.jsx)(a.A,{sx:{width:"80px",textAlign:"center"},children:(0,Y.jsx)(l.A,{variant:"subtitle2",align:"center",sx:{fontWeight:"bold"},children:"\u65f6\u95f4"})}),e.map((e,t)=>{const r=M(e),s=e.toDateString()===(new Date).toDateString();return(0,Y.jsx)(a.A,{sx:{flex:"1 1 14.28%"},children:(0,Y.jsxs)(d.A,{sx:{p:1,textAlign:"center",backgroundColor:s?"primary.main":"background.paper",color:s?"primary.contrastText":"text.primary"},children:[(0,Y.jsx)(l.A,{variant:"subtitle2",sx:{fontWeight:"bold"},children:v[e.getDay()]}),(0,Y.jsx)(l.A,{variant:"body2",children:e.getDate()}),(0,Y.jsx)(Xe.A,{badgeContent:r.length,color:"error",sx:{mt:.5},children:(0,Y.jsx)(tt.A,{fontSize:"small"})})]})},t)})]}),(0,Y.jsx)(d.A,{sx:{overflow:"auto",maxHeight:600},children:["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"].map((t,r)=>(0,Y.jsxs)(a.A,{sx:{display:"flex",minHeight:60,borderBottom:1,borderColor:"divider"},children:[(0,Y.jsx)(a.A,{sx:{width:"80px",p:1,textAlign:"center",borderRight:1,borderColor:"divider"},children:(0,Y.jsx)(l.A,{variant:"caption",color:"text.secondary",children:t})}),e.map((e,r)=>{const s=M(e).filter(e=>e.time&&e.time.startsWith(t.substring(0,2)));return(0,Y.jsx)(a.A,{sx:{flex:"1 1 14.28%"},children:(0,Y.jsx)(a.A,{sx:{p:.5,minHeight:50,borderRight:1,borderColor:"divider"},children:s.map(e=>L(e))})},r)})]},r))})]})})()})]})},it=["children","value","index"];function ot(e){const{children:t,value:r,index:s}=e,n=(0,c.A)(e,it);return(0,Y.jsx)("div",(0,o.A)((0,o.A)({role:"tabpanel",hidden:r!==s,id:"schedule-tabpanel-".concat(s),"aria-labelledby":"schedule-tab-".concat(s)},n),{},{children:r===s&&(0,Y.jsx)(a.A,{sx:{p:3},children:t})}))}function ct(e){return{id:"schedule-tab-".concat(e),"aria-controls":"schedule-tabpanel-".concat(e)}}const dt=()=>{const[e,t]=(0,s.useState)(0),[r,n]=(0,s.useState)([]),[l,i]=(0,s.useState)({}),[c,w]=(0,s.useState)(!1),[k,T]=(0,s.useState)(null),[D,W]=(0,s.useState)(null),[I,B]=(0,s.useState)(!1),[z,H]=(0,s.useState)(!1),[E,R]=(0,s.useState)(null),[F,P]=(0,s.useState)(null),[M,_]=(0,s.useState)(1),[O,L]=(0,s.useState)("2024-1"),[G,N]=(0,s.useState)(1);(0,s.useEffect)(()=>{U(),K()},[O,G]);const U=async()=>{try{var e;w(!0);if(!localStorage.getItem("token"))return console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u83b7\u53d6\u8bfe\u7a0b\u5217\u8868"),n([]),void T("\u8bf7\u5148\u767b\u5f55\u4ee5\u67e5\u770b\u8bfe\u7a0b\u5217\u8868");const t=await S.getCourses({isActive:!0});t.success&&null!==(e=t.data)&&void 0!==e&&e.courses&&n(t.data.courses)}catch(k){var t,r;console.error("Error loading courses:",k),"NETWORK_ERROR"===(null===k||void 0===k||null===(t=k.data)||void 0===t?void 0:t.error)||401===(null===k||void 0===k||null===(r=k.response)||void 0===r?void 0:r.status)?(T("\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"),n([])):T("\u52a0\u8f7d\u8bfe\u7a0b\u5217\u8868\u5931\u8d25"),console.error("\u52a0\u8f7d\u8bfe\u7a0b\u5931\u8d25:",k)}finally{w(!1)}},K=async()=>{try{w(!0);if(!localStorage.getItem("token"))return console.log("\u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u6cd5\u83b7\u53d6\u8bfe\u8868"),i([]),void T("\u8bf7\u5148\u767b\u5f55\u4ee5\u67e5\u770b\u8bfe\u8868");const e=await S.getSchedule({semester:O,week:G});e.success&&e.data&&i(e.data)}catch(k){var e,t;console.error("Error loading schedule:",k),"NETWORK_ERROR"===(null===k||void 0===k||null===(e=k.data)||void 0===e?void 0:e.error)||401===(null===k||void 0===k||null===(t=k.response)||void 0===t?void 0:t.status)?(T("\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"),i([])):T("\u52a0\u8f7d\u8bfe\u8868\u5931\u8d25"),console.error("\u52a0\u8f7d\u8bfe\u8868\u5931\u8d25:",k)}finally{w(!1)}},q=()=>{B(!1),R(null)},Z=e=>{_(e),P(null),H(!0)},J=()=>{H(!1),P(null)},V=()=>{T(null),W(null)};return(0,Y.jsxs)(a.A,{children:[(0,Y.jsxs)(d.A,{sx:{width:"100%"},children:[(0,Y.jsx)(a.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,Y.jsxs)(x.A,{value:e,onChange:(e,r)=>{t(r)},"aria-label":"\u8bfe\u8868\u7ba1\u7406\u6807\u7b7e",children:[(0,Y.jsx)(h.A,(0,o.A)({icon:(0,Y.jsx)(p.A,{}),label:"\u8bfe\u8868\u89c6\u56fe"},ct(0))),(0,Y.jsx)(h.A,(0,o.A)({icon:(0,Y.jsx)(f.A,{}),label:"\u65e5\u5386\u89c6\u56fe"},ct(1))),(0,Y.jsx)(h.A,(0,o.A)({icon:(0,Y.jsx)(b.A,{}),label:"\u8bfe\u7a0b\u7ba1\u7406"},ct(2))),(0,Y.jsx)(h.A,(0,o.A)({icon:(0,Y.jsx)(y.A,{}),label:"\u6587\u4ef6\u4e0a\u4f20"},ct(3))),(0,Y.jsx)(h.A,(0,o.A)({icon:(0,Y.jsx)(v.A,{}),label:"\u6a21\u677f\u8bbe\u7f6e"},ct(4))),(0,Y.jsx)(h.A,(0,o.A)({icon:(0,Y.jsx)(C.A,{}),label:"\u8bfe\u8868\u6bd4\u5bf9"},ct(5)))]})}),(0,Y.jsx)(ot,{value:e,index:0,children:(0,Y.jsx)(ee,{schedule:l,courses:r,currentSemester:O,currentWeek:G,onSemesterChange:L,onWeekChange:N,onSlotCreate:Z,onSlotEdit:e=>{P(e),H(!0)},onSlotDelete:async e=>{try{w(!0),await S.deleteScheduleSlot(e),W("\u8bfe\u8868\u5220\u9664\u6210\u529f"),K()}catch(k){T("\u5220\u9664\u8bfe\u8868\u5931\u8d25"),console.error("\u5220\u9664\u8bfe\u8868\u5931\u8d25:",k)}finally{w(!1)}},loading:c})}),(0,Y.jsx)(ot,{value:e,index:1,children:(0,Y.jsx)(lt,{schedule:l,courses:r,currentSemester:O,currentWeek:G,onSemesterChange:L,onWeekChange:N})}),(0,Y.jsx)(ot,{value:e,index:2,children:(0,Y.jsx)(Q,{courses:r,onCourseEdit:e=>{R(e),B(!0)},onCourseDelete:async e=>{try{w(!0),await S.deleteCourse(e),W("\u8bfe\u7a0b\u5220\u9664\u6210\u529f"),U(),K()}catch(k){T("\u5220\u9664\u8bfe\u7a0b\u5931\u8d25"),console.error("\u5220\u9664\u8bfe\u7a0b\u5931\u8d25:",k)}finally{w(!1)}},onRefresh:U,loading:c})}),(0,Y.jsx)(ot,{value:e,index:3,children:(0,Y.jsx)(oe,{onUploadSuccess:()=>{W("\u6587\u4ef6\u4e0a\u4f20\u6210\u529f"),K()},onError:T})}),(0,Y.jsx)(ot,{value:e,index:4,children:(0,Y.jsx)(Ce,{})}),(0,Y.jsx)(ot,{value:e,index:5,children:(0,Y.jsx)(Je,{currentSchedule:l,currentCourses:r,currentSemester:O})})]}),(0===e||2===e)&&(0,Y.jsx)(u.A,{color:"primary","aria-label":"\u6dfb\u52a0",sx:{position:"fixed",bottom:16,right:16},onClick:()=>{switch(e){case 0:Z(1);break;case 2:R(null),B(!0)}},children:(()=>{switch(e){case 0:return(0,Y.jsx)(p.A,{});case 2:default:return(0,Y.jsx)(g.A,{});case 3:return(0,Y.jsx)(y.A,{});case 4:return(0,Y.jsx)(v.A,{})}})()}),(0,Y.jsx)(he,{open:I,course:E,onClose:q,onSubmit:async e=>{try{w(!0),E?(await S.updateCourse(E._id,e),W("\u8bfe\u7a0b\u66f4\u65b0\u6210\u529f")):(await S.createCourse(e),W("\u8bfe\u7a0b\u521b\u5efa\u6210\u529f")),q(),U()}catch(k){T(E?"\u66f4\u65b0\u8bfe\u7a0b\u5931\u8d25":"\u521b\u5efa\u8bfe\u7a0b\u5931\u8d25"),console.error("\u8bfe\u7a0b\u64cd\u4f5c\u5931\u8d25:",k)}finally{w(!1)}},loading:c}),(0,Y.jsx)(ge,{open:z,slot:F,courses:r,defaultDay:M,onClose:J,onSubmit:async e=>{try{w(!0),F?(await S.updateScheduleSlot(F._id,e),W("\u8bfe\u8868\u66f4\u65b0\u6210\u529f")):(await S.addScheduleSlot((0,o.A)((0,o.A)({},e),{},{semester:O})),W("\u8bfe\u8868\u6dfb\u52a0\u6210\u529f")),J(),K()}catch(k){T(F?"\u66f4\u65b0\u8bfe\u8868\u5931\u8d25":"\u6dfb\u52a0\u8bfe\u8868\u5931\u8d25"),console.error("\u8bfe\u8868\u64cd\u4f5c\u5931\u8d25:",k)}finally{w(!1)}},loading:c}),(0,Y.jsx)(m.A,{open:!!k,autoHideDuration:6e3,onClose:V,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,Y.jsx)(A.A,{onClose:V,severity:"error",sx:{width:"100%"},children:k})}),(0,Y.jsx)(m.A,{open:!!D,autoHideDuration:4e3,onClose:V,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,Y.jsx)(A.A,{onClose:V,severity:"success",sx:{width:"100%"},children:D})}),c&&(0,Y.jsx)(a.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(255, 255, 255, 0.7)",zIndex:9999},children:(0,Y.jsx)(j.A,{})})]})},xt=()=>(0,Y.jsxs)(n.A,{maxWidth:"xl",sx:{py:4},children:[(0,Y.jsxs)(a.A,{mb:4,children:[(0,Y.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,Y.jsx)(i.A,{style:{width:32,height:32,marginRight:12,color:"#1976d2"}}),(0,Y.jsx)(l.A,{variant:"h4",component:"h1",sx:{fontWeight:"bold",fontSize:"1.5rem"},children:"\u6211\u7684\u8bfe\u8868\u7ba1\u7406\u7cfb\u7edf"})]}),(0,Y.jsx)(l.A,{variant:"body1",color:"text.secondary",sx:{fontSize:"1rem",lineHeight:1.6},children:"\u7ba1\u7406\u60a8\u7684\u8bfe\u7a0b\u5b89\u6392\u3001\u4e0a\u4f20\u8bfe\u8868\u6587\u4ef6\u3001\u81ea\u5b9a\u4e49\u989c\u8272\u4e3b\u9898\uff0c\u5e76\u4e3a\u6bcf\u95e8\u8bfe\u7a0b\u6dfb\u52a0\u8bc4\u4ef7"})]}),(0,Y.jsx)(dt,{})]})},48605:(e,t,r)=>{r.d(t,{A:()=>n});var s=r(82715);const n=new class{constructor(){this.apiClient={get:(e,t)=>s.A.get("/reminders".concat(e),t),post:(e,t,r)=>s.A.post("/reminders".concat(e),t,r),put:(e,t,r)=>s.A.put("/reminders".concat(e),t,r),delete:(e,t)=>s.A.delete("/reminders".concat(e),t)}}async getReminders(e){try{const t=await this.apiClient.get("/",{params:e});return t.data||t}catch(s){var t,r;throw new Error((null===(t=s.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"\u83b7\u53d6\u63d0\u9192\u4e8b\u9879\u5931\u8d25")}}async getUpcomingReminders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24;try{const t=await this.apiClient.get("/upcoming",{params:{hours:e}});return t.data||t}catch(r){var t;throw new Error((null===(t=r.data)||void 0===t?void 0:t.message)||"\u83b7\u53d6\u5373\u5c06\u5230\u6765\u7684\u63d0\u9192\u5931\u8d25")}}async createReminder(e){try{const t=await this.apiClient.post("/",e);return t.data||t}catch(r){var t;throw new Error((null===(t=r.data)||void 0===t?void 0:t.message)||"\u521b\u5efa\u63d0\u9192\u4e8b\u9879\u5931\u8d25")}}async updateReminder(e,t){try{const r=await this.apiClient.put("/".concat(e),t);return r.data||r}catch(s){var r;throw new Error((null===(r=s.data)||void 0===r?void 0:r.message)||"\u66f4\u65b0\u63d0\u9192\u4e8b\u9879\u5931\u8d25")}}async completeReminder(e){try{const t=await this.apiClient.put("/".concat(e,"/complete"));return t.data||t}catch(r){var t;throw new Error((null===(t=r.data)||void 0===t?void 0:t.message)||"\u5b8c\u6210\u63d0\u9192\u5931\u8d25")}}async snoozeReminder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{const r=await this.apiClient.put("/".concat(e,"/snooze"),{minutes:t});return r.data||r}catch(s){var r;throw new Error((null===(r=s.data)||void 0===r?void 0:r.message)||"\u5ef6\u8fdf\u63d0\u9192\u5931\u8d25")}}async deleteReminder(e){try{const t=await this.apiClient.delete("/".concat(e));return t.data||t}catch(r){var t;throw new Error((null===(t=r.data)||void 0===t?void 0:t.message)||"\u5220\u9664\u63d0\u9192\u4e8b\u9879\u5931\u8d25")}}async getReminderStats(){try{const e=await this.apiClient.get("/stats");return e.data||e}catch(t){var e;throw new Error((null===(e=t.data)||void 0===e?void 0:e.message)||"\u83b7\u53d6\u7edf\u8ba1\u4fe1\u606f\u5931\u8d25")}}}}}]);